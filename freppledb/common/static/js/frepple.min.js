/* frePPLe 4.0.0
Copyright (C) 2010-2019 by frePPLe bv

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files(the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/ or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT.IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

function isDragnDropUploadCapable(){var t=document.createElement("div");return("draggable"in t||"ondragstart"in t&&"ondrop"in t)&&"FormData"in window&&"FileReader"in window}var _scrollBarWidth;function getScrollBarWidth(){if(!_scrollBarWidth){var t=$("<div style='overflow:scroll;position:absolute;top:-99999px'></div>").appendTo("body");_scrollBarWidth=t.prop("offsetWidth")-t.prop("clientWidth"),t.remove()}return _scrollBarWidth}function breadcrumbs_reflow(){var t=$("#breadcrumbs"),e=$(".breadcrumbrow"),a=e.parent().width(),o=$("#database").closest(".navbar-nav").width();o&&(a-=o),t.children("li.d-none").removeClass("d-none");var i=!0;t.children("li").each(function(){e.width()>a&&!i&&$(this).addClass("d-none"),i=!1})}function admin_escape(t){return t?t.replace(/_/g,"_5F").replace(/:/g,"_3A").replace(/\//g,"_2F").replace(/#/g,"_23").replace(/\?/g,"_3F").replace(/;/g,"_3B").replace(/@/g,"_40").replace(/&/g,"_26").replace(/=/g,"_3D").replace(/\+/g,"_2B").replace(/\$/g,"_24").replace(/,/g,"_2C").replace(/"/g,"_22").replace(/</g,"_3C").replace(/>/g,"_3E").replace(/%/g,"_25").replace(/\\/g,"_5C").replace(/\t/g,"%09"):""}function admin_unescape(t){return t.replace(/%09/g,"\t").replace(/_5C/g,"\\").replace(/_25/g,"%").replace(/_3E/g,">").replace(/_3C/g,"<").replace(/_22/g,'"').replace(/_2C/g,",").replace(/_24/g,"$").replace(/_2B/g,"+").replace(/_3D/g,"=").replace(/_26/g,"&").replace(/_40/g,"@").replace(/_3B/g,";").replace(/_3F/g,"?").replace(/_23/g,"#").replace(/_2F/g,"/").replace(/_3A/g,":").replace(/_5F/g,"_")}function escapeAttribute(t){return"string"==typeof t||t instanceof String?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):t}function ajaxerror(t,e,a){var o;401!=t.status?(o=0==t.readyState?gettext("Connection failed"):a?"<strong>"+a+"</strong><br>"+t.responseText:t.responseText,hideModal("timebuckets"),$("#save i").addClass("hidden"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-danger"><h5 class="modal-title">'+gettext("Error")+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><p>'+o+'</p></div><div class="modal-footer"><input type="submit" role="button" class="btn btn-primary" data-bs-dismiss="modal" value="'+gettext("Close")+'"></div></div></div>'),showModal("popup")):location.reload()}$.fn.resizable=function(t){var e={handleSelector:null,resizeWidth:!0,resizeHeight:!0,onDragStart:null,onDragEnd:null,onDrag:null,touchActionNone:!0,reverse:!1};return"object"==typeof t&&(e=$.extend(e,t)),this.each(function(){var t,a,o=$(this);if(!$(this).hasClass("ui-jqgrid")){var i=e.handleSelector?$(e.handleSelector):o;e.touchActionNone&&i.css("touch-action","none"),o.addClass("resizable"),i.bind("mousedown.rsz touchstart.rsz",function(i){if((t=l(i)).width=parseInt(o.width(),10),t.height=parseInt(o.height(),10),a=o.css("transition"),o.css("transition","none"),e.onDragStart&&!1===e.onDragStart(i,o,e))return;e.dragFunc=s,$(document).bind("mousemove.rsz",e.dragFunc),$(document).bind("mouseup.rsz",n),(window.Touch||navigator.maxTouchPoints)&&($(document).bind("touchmove.rsz",e.dragFunc),$(document).bind("touchend.rsz",n));$(document).bind("selectstart.rsz",r)})}function r(t){t.stopPropagation(),t.preventDefault()}function s(a){var i=l(a);if(e.resizeWidth){var r=e.reverse?t.width-i.x+t.x:t.width+i.x-t.x;o.width(r)}if(e.resizeHeight){var s=t.height+i.y-t.y;o.height(s)}e.onDrag&&e.onDrag(a,o,e)}function n(t){return t.stopPropagation(),t.preventDefault(),$(document).unbind("mousemove.rsz",e.dragFunc),$(document).unbind("mouseup.rsz",n),(window.Touch||navigator.maxTouchPoints)&&($(document).unbind("touchmove.rsz",e.dragFunc),$(document).unbind("touchend.rsz",n)),$(document).unbind("selectstart.rsz",r),o.css("transition",a),e.onDragEnd&&e.onDragEnd(t,o,e),!1}function l(t){var e={x:0,y:0,width:0,height:0};if("number"==typeof t.clientX)e.x=t.clientX,e.y=t.clientY;else{if(!t.originalEvent.touches)return null;e.x=t.originalEvent.touches[0].clientX,e.y=t.originalEvent.touches[0].clientY}return e}})};var upload={warnUnsavedChanges:function(){return $(window).off("beforeunload",upload.warnUnsavedChanges),gettext("There are unsaved changes on this page.")},undo:function(){if(!$("#undo").hasClass("btn-primary")){if("function"==typeof extraSearchUpdate){var t=$("#grid").getGridParam("postData").filters;extraSearchUpdate(t?JSON.parse(t):null)||$("#grid").trigger("reloadGrid")}else $("#grid").trigger("reloadGrid");$("#grid").closest(".ui-jqgrid-bdiv").scrollTop(0),$("#save, #undo").addClass("btn-primary").removeClass("btn-danger").prop("disabled",!0),$("#gridactions").prop("disabled",!0),$(".ng-dirty").removeClass("ng-dirty"),$(window).off("beforeunload",upload.warnUnsavedChanges)}},select:function(){$.jgrid.hideModal("#searchmodfbox_grid"),$("#save, #undo").removeClass("btn-primary").addClass("btn-danger").prop("disabled",!1),$(window).off("beforeunload",upload.warnUnsavedChanges),$(window).on("beforeunload",upload.warnUnsavedChanges)},selectedRows:[],restoreSelection:function(){for(var t in grid.markSelectedRow(upload.selectedRows.length),upload.selectedRows)$("#grid").jqGrid("setSelection",upload.selectedRows[t],!1);upload.selectedRows=[]},save:function(t){if(!$("#save").hasClass("btn-primary")){if($("#grid").saveCell(editrow,editcol),"function"==typeof getDirtyData)var e=getDirtyData();else e=$("#grid").getChangedCells("dirty");var a=$("#grid").jqGrid("getGridParam","selarrrow");upload.selectedRows=a?a.slice():null,null!=e&&e.length>0&&($("#save i").removeClass("hidden"),"undefined"!=typeof saveData?saveData(e,t):$.ajax({url:location.pathname,data:JSON.stringify(e),type:"POST",contentType:"application/json",success:function(){upload.undo(),$("#save i").addClass("hidden"),$(".ng-dirty").removeClass("ng-dirty"),void 0!==t&&t()},error:ajaxerror}))}},validateSort:function(t){"grid_cb"!=$(this).attr("id")&&($("body").hasClass("popup")||($("#save").hasClass("btn-primary")?jQuery("#grid").jqGrid("resetSelection"):(hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header alert-warning" style="border-top-left-radius: inherit; border-top-right-radius: inherit"><h5 class="modal-title">'+gettext("Save or cancel your changes first")+'</h5></div><div class="modal-body">'+gettext("There are unsaved changes on this page.")+'</div><div class="modal-footer justify-content-between"><input type="submit" id="savebutton" role="button" class="btn btn-danger" value="'+gettext("Save")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary" value="'+gettext("Return to page")+'"></div></div></div>'),showModal("popup"),$("#savebutton").on("click",function(){upload.save(),hideModal("popup")}),$("#cancelbutton").on("click",function(){upload.undo(),hideModal("popup")}),t.stopPropagation())))}};function opendetail(t){var e=$(t.target).parent(),a=e.attr("href"),o=e.attr("objectid");void 0!==o&&0!=o||(o=e.parent().text().trim()),t.preventDefault(),t.stopImmediatePropagation(),window.location.href=url_prefix+a.replace("key",admin_escape(o))}function formatDuration(t,e,a){var o,i,r,s=0,n=0,l=[],d=[];if(void 0===t||""===t||null===t)return"";if("number"==typeof t)n=t,r=Math.sign(n);else switch(r="-"==$.trim(t).charAt(0)?-1:1,1==(l=t.replace(/ +/g," ").split(" ")).length?(d=t.split(":"),s=0):(d=l[1].split(":"),s=""!=l[0]?parseFloat(l[0]):0),d.length){case 0:n=86400*Math.abs(s);break;case 1:n=86400*Math.abs(s)+(""!=d[0]?Math.abs(parseFloat(d[0])):0);break;case 2:n=86400*Math.abs(s)+60*(""!=d[0]?Math.abs(parseFloat(d[0])):0)+(""!=d[1]?parseFloat(d[1]):0);break;default:n=86400*Math.abs(s)+3600*(""!=d[0]?Math.abs(parseFloat(d[0])):0)+60*(""!=d[1]?parseFloat(d[1]):0)+(""!=d[2]?parseFloat(d[2]):0)}return n=(n=Math.abs(n))-86400*(s=Math.floor(n/86400))-3600*(o=Math.floor((n-86400*s)/3600))-60*(i=Math.floor((n-86400*s-3600*o)/60)),s>1825?"N/A":s>0?(r*s).toString()+" "+(o<10?"0":"")+o+(i<10?":0":":")+i+(n<10?":0":":")+Number(n.toFixed(n===Math.floor(n)?0:6)):(r<0?"-":"")+(o<10?"0":"")+o+(i<10?":0":":")+i+(n<10?":0":":")+Number(n.toFixed(n===Math.floor(n)?0:6))}jQuery.extend($.fn.fmatter,{percentage:function(t,e,a){return void 0===t||""===t||null===t?"":grid.formatNumber(t)+"%"},duration:formatDuration,currencyWithBlanks:function(t,e,a){return void 0===t||null===t?"":$.fn.fmatter.call(this,"currency",t,e)},image:function(t,e,a){return t?'<img class="avatar-sm" src="/uploads/'+t+'">':""},admin:function(t,e,a){return void 0===t||""===t||null===t?"":e.colModel.popup||"0"===a.showdrilldown?$.jgrid.htmlEncode(t):$.jgrid.htmlEncode(t)+'<a href="'+url_prefix+"/data/"+e.colModel.role+"/"+admin_escape(t)+"/change/\" onclick='event.stopPropagation()'><span class='ps-2 fa fa-caret-right'></span></a>"},detail:function(t,e,a){if(void 0===t||""===t||null===t)return"";if(e.colModel.popup)return $.jgrid.htmlEncode(t);if("operation"==e.colModel.name){if(a.hasOwnProperty("type")&&("PO"===a.type||"DO"===a.type||"DLVR"===a.type||"STCK"===a.type))return $.jgrid.htmlEncode(t);if(a.hasOwnProperty("operationplan__type")&&("PO"===a.operationplan__type||"DO"===a.operationplan__type||"DLVR"===a.operationplan__type||"STCK"===a.operationplan__type))return $.jgrid.htmlEncode(t)}return $.jgrid.htmlEncode(t)+'<a href="'+url_prefix+"/detail/"+e.colModel.role+"/"+admin_escape(t)+"/\" onclick='event.stopPropagation()'><span class='ps-2 fa fa-caret-right'></span></a>"},demanddetail:function(t,e,a){if(void 0===t||""===t)return"";if(e.colModel.popup)return $.jgrid.htmlEncode(t);for(var o="",i=t.length,r=0;r<i;r++)""!=o&&(o+=", "),"F"==t[r][2]?o+=t[r][0]+" : "+$.jgrid.htmlEncode(t[r][1])+'<a href="'+url_prefix+"/detail/forecast/forecast/"+admin_escape(t[r][1]).substring(0,admin_escape(t[r][1]).length-13)+"/\" onclick='event.stopPropagation()' objectid='"+$.jgrid.htmlEncode(t[r][1]).substring(0,$.jgrid.htmlEncode(t[r][1]).length-13)+"'><span class='ps-2 fa fa-caret-right' role='forecast/forecast'></span></a>":o+=t[r][0]+" : "+$.jgrid.htmlEncode(t[r][1])+'<a href="'+url_prefix+"/detail/input/demand/"+admin_escape(t[r][1])+"/\" onclick='event.stopPropagation()'><span class='ps-2 fa fa-caret-right' role='input/demand'></span></a>";return o},forecastdetail:function(t,e,a){return void 0===t||""===t||null===t?"":e.colModel.popup||"0"===a.showdrilldown?$.jgrid.htmlEncode(t):a.hasOwnProperty("hasForecastRecord")&&"True"===a.hasForecastRecord?$.jgrid.htmlEncode(t)+'<a href="'+url_prefix+"/detail/"+e.colModel.role+"/"+admin_escape(t)+"/\" onclick='event.stopPropagation()'><span class='ps-2 fa fa-caret-right'></span></a>":$.jgrid.htmlEncode(t)},listdetail:function(t,e,a){if(void 0===t||""===t)return"";if(e.colModel.popup)return t;for(var o="",i=t.length,r=0;r<i;r++)""!=o&&(o+=", "),o+='<span><span class="listdetailkey"',t[r].length>2&&(o+=' data-extra="'+$.jgrid.htmlEncode(t[r][2])+'"'),o+=">"+$.jgrid.htmlEncode(t[r][0])+'</span><a href="'+url_prefix+"/detail/"+e.colModel.role+"/"+admin_escape(t[r][0])+"/\" onclick='event.stopPropagation()'><span class='ps-2 fa fa-caret-right' role='"+e.colModel.role+"'></span></a></span>&nbsp;<span>"+t[r][1]+"</span>";return o},graph:function(t,e,a){return'<div class="graph" style="height:80px"></div>'},longstring:function(t,e,a){if("string"!=typeof t)return"";var o=$.jgrid.htmlEncode(t);return o?'<span data-bs-toggle="tooltip" data-bs-placement="left" data-bs-title="'+o+'">'+o+"</span>":tipcontentreturn},selectbutton:function(t,e,a){return t?'<button onClick="opener.dismissRelatedLookupPopup(window, grid.selected)" class="btn btn-primary btn-sm">'+gettext("select")+"</button>":""},color:function(t,e,a){if(void 0===a.color||""===a.color||null===t)return"";var o=Math.round(parseInt(a.delay)/86400);return 999===parseInt(a.criticality)||999===parseInt(a.operationplan__criticality)?"":o<0?'<div class="invStatus" style="background-color: #008000; color: #151515;">'+-o+" "+gettext("days early")+"</div>":0===o?'<div class="invStatus" style="background-color: #008000; color: #151515;">'+gettext("on time")+"</div>":o>0?'<div class="invStatus" style="background-color: #f00; color: #151515;">'+o+" "+gettext("days late")+"</div>":""},number:function(t,e){return window.SKIP_FORMATER?t:grid.formatNumber(t)}}),jQuery.extend($.fn.fmatter.percentage,{unformat:function(t,e,a){return t.replace("%","")}}),jQuery.extend($.fn.fmatter.listdetail,{unformat:function(t,e,a){var o=[];return $(".listdetailkey",$(a)).each(function(t,e){o.push([$(e).text(),$(e).parent().next("span").text(),$(e).attr("data-extra")])}),o}}),jQuery.extend($.fn.fmatter.currencyWithBlanks,{unformat:function(t,e,a){var o=e.colModel.formatoptions.prefix,i=e.colModel.formatoptions.suffix,r=$(a).closest("table").first(),s=r.jqGrid("getGridRes","formatter.currency.thousandsSeparator").replace(/([\.\*\_\'\(\)\{\}\+\?\\])/g,"\\$1"),n=r.jqGrid("getGridRes","formatter.currency.decimalSeparator");return o&&o.length&&(t=t.substr(o.length)),i&&i.length&&(t=t.substr(0,t.length-i.length)),t=t.replace(new RegExp(s,"g"),""),"."!=n&&(t=t.replace(n,".")),t}});var grid={selected:void 0,formatNumber:function(t,e=6){if(void 0===t||""===t)return"";var a=$.fmatter.isNumber;if(a(t)||(t*=1),a(t)){var o,i=t<0,r=Math.abs(t);o=r>1e5||e<=0?String(parseFloat(t.toFixed())):r>1e4||e<=1?String(parseFloat(t.toFixed(1))):r>1e3||e<=2?String(parseFloat(t.toFixed(2))):r>100||e<=3?String(parseFloat(t.toFixed(3))):r>10||e<=4?String(parseFloat(t.toFixed(4))):r>1||e<=5?String(parseFloat(t.toFixed(5))):String(parseFloat(t.toFixed(e)));var s=jQuery("#grid").jqGrid("getGridRes","formatter.number.decimalSeparator")||".";"."!==s&&(o=o.replace(".",s));var n=jQuery("#grid").jqGrid("getGridRes","formatter.number.thousandsSeparator")||",";if(n){var l=o.lastIndexOf(s);l=l>-1?l:o.length;var d,c=void 0===s?"":o.substring(l),p=-1;for(d=l;d>0;d--)++p%3==0&&d!==l&&(!i||d>1)&&(c=n+c),c=o.charAt(d-1)+c;o=c}return o}return t},summary_last:function(t,e,a){return a[e]},summary_first:function(t,e,a){return t||a[e]},setSelectedRow:function(t){void 0!=grid.selected&&$(this).jqGrid("setCell",grid.selected,"select",null),grid.selected=t,$(this).jqGrid("setCell",t,"select",!0)},runAction:function(t){["no_action","actions1"].includes($("#actions").val())||actions[$("#actions").val()]()},setStatus:function(t,e){var a=jQuery("#grid").jqGrid("getGridParam","selarrrow");for(var o in a)jQuery("#grid").jqGrid("setCell",a[o],e?e+"status":"status",t,"dirty-cell"),jQuery("#grid").jqGrid("setRowData",a[o],!1,"edited");$("#actions1").html(gettext("Select action")),$("#save").removeClass("btn-primary").addClass("btn-danger").prop("disabled",!1),$("#undo").removeClass("btn-primary").addClass("btn-danger").prop("disabled",!1)},_cached_cross:null,pivotcolumns:function(t,e,a){if(grid._cached_cross)return grid._cached_cross;var o="";for(var i of cross_idx)if(!cross[i].hidden){var r="fa-plus-square-o";for(var s of cross_idx){if(i!=s&&cross[s].expand)if(cross[s].expand.includes(cross[i].key))o+="&nbsp;&nbsp;&nbsp;";else for(var n in cross)cross[s].expand.includes(cross[n].key)&&cross[n].expand&&cross[n].expand.includes(cross[i].key)&&(o+="&nbsp;&nbsp;&nbsp;");cross[i].expand&&cross[i].expand.includes(cross[s].key)&&(r="fa-minus-square-o")}cross[i].editable?o+=cross[i].name+'<input style="width:0px" class="invisible"/><br>':cross[i].expand?o+=cross[i].name+'&nbsp;<i style="cursor: pointer" class="fa '+r+'" onclick="grid.expandCross(this, '+i+')"></i><br>':o+=cross[i].name+"<br>"}return grid._cached_cross=o,o},showCustomize:function(t,e,a,o,i,r,s){hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid");var n=$(void 0!==e?e:"#grid").jqGrid("getGridParam","colModel"),l=0,d=0,c=!1,p=t&&void 0!==i&&i,u=p?"":'<div class="row mb-3"><div class="col"><div class="card"><div class="card-header">'+gettext("Selected options")+'</div><div class="card-body"><ul class="list-group" id="Rows" style="height: 160px; overflow-y: scroll;">placeholder0</ul></div></div></div><div class="col"><div class="card"><div class="card-header">'+gettext("Available options")+'</div><div class="card-body"><ul class="list-group" id="DroppointRows" style="height: 160px; overflow-y: scroll;">placeholder1</ul></div></div></div></div>',f="",h="",g="",m={},v="",b="";for(var x in n)"graph"==n[x].name?c=!0:"rn"==n[x].name||"cb"==n[x].name||null==n[x].counter||""==n[x].label||"alwayshidden"in n[x]?d++:(n[x].frozen&&(l=parseInt(x,10)+1-d),n[x].hidden?m[n[x].label]=x:g+='<li id="'+x+'"  class="list-group-item" style="cursor: move;">'+n[x].label+"</li>");if(t){var y=void 0!==a?a:cross,w=void 0!==o?o:cross_idx;f='<div class="row"><div class="col"><div class="card"><div class="card-header">'+gettext("Selected Cross")+'</div><div class="card-body"><ul class="list-group" id="Crosses" style="height: 160px; overflow-y: scroll;">placeholder0</ul></div></div></div><div class="col"><div class="card"><div class="card-header">'+gettext("Available Cross")+'</div><div class="card-body"><ul class="list-group" id="DroppointCrosses" style="height: 160px; overflow-y: scroll;">placeholder1</ul></div></div></div></div>';for(var k in w)v+='<li class="list-group-item" id="'+(1e3+parseInt(w[k],10))+'" style="cursor: move;">'+y[w[k]].name+"</li>";var _={};for(var k in y)w.indexOf(parseInt(k,10))>-1||""==y[k].name||(_[y[k].name]=parseInt(k,10));for(var k of Object.keys(_).sort())b+='<li class="list-group-item" id="'+(1e3+_[k])+'" style="cursor: move;">'+k+"</li>"}else{h='<div class="row mt-3"><div class="col">'+gettext("Frozen columns")+'&nbsp;&nbsp;<select id="frozen" class="form-select w-auto d-inline">';var C=Math.min(n.length,5);for(x=0;x<=C;x++)h+=x==l?'<option selected value="'+x+'">'+x+"</option>":'<option value="'+x+'">'+x+"</option>";h+="</select></div></div>"}u=u.replace("placeholder0",g);var M="";for(var j of Object.keys(m).sort())M+='<li id="'+m[j]+'" class="list-group-item" style="cursor: move">'+j+"</li>";if(u=u.replace("placeholder1",M),t&&(f=(f=f.replace("placeholder0",v)).replace("placeholder1",b)),$("#popup").html('<div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">'+gettext("Customize")+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label='+gettext("Close")+'></button></div><div class="modal-body">'+u+f+h+("undefined"!=typeof extra_customize_html?extra_customize_html:"")+'</div><div class="modal-footer justify-content-between"><input type="submit" id="cancelCustbutton" role="button" class="btn btn-gray" data-bs-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" id="resetCustbutton" role="button" class="btn btn-gray" value="'+gettext("Reset")+'"><input type="submit" id="okCustbutton" role="button" class="btn btn-primary" value="'+gettext("OK")+'"></div></div></div>'),showModal("popup"),!p){var T=document.getElementById("Rows"),z=document.getElementById("DroppointRows");Sortable.create(T,{group:{name:"Rows",put:["DroppointRows"]},animation:100}),Sortable.create(z,{group:{name:"DroppointRows",put:["Rows"]},animation:100})}if(t){var D=document.getElementById("Crosses"),G=document.getElementById("DroppointCrosses");Sortable.create(D,{group:{name:"Crosses",put:["DroppointCrosses"]},animation:100}),Sortable.create(G,{group:{name:"DroppointCrosses",put:["Crosses"]},animation:100})}$("#resetCustbutton").on("click",void 0!==s?s:function(){var t={};if(t[reportkey]={favorites:favorites},"undefined"!=typeof url_prefix)var e=url_prefix+"/settings/";else e="/settings/";$.ajax({url:e,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(t),success:function(){window.location.href=window.location.href},error:ajaxerror})}),$("#okCustbutton").on("click",void 0!==r?r:function(){var e=$("#grid")[0].p.colModel,a=[],o=[];"cb"==e[0].name&&a.push(0),cross_idx=[];try{c||$("#grid").jqGrid("destroyFrozenColumns")}catch(t){console.log("Error destroying frozen columns:",t)}$("#Rows li").each(function(){var t=parseInt(this.id,10);t<1e3&&($("#grid").jqGrid("showCol",e[t].name),a.push(t))}),$("#DroppointRows li").each(function(){var a=parseInt(this.id,10);a<1e3&&(o.push(a),t&&$("#grid").jqGrid("setColProp",e[a].name,{frozen:!1}),$("#grid").jqGrid("hideCol",e[a].name))}),$("#Crosses li").each(function(){var t=parseInt(this.id,10);t>=1e3&&cross_idx.push(t-1e3)});var i=0;if(t)for(var r in e)"counter"in e[r]?i=parseInt(r)+1:a.push(parseInt(r));else i=parseInt($("#frozen").val());for(var r in o)a.push(o[r]);for(var r in e)"alwayshidden"in e[r]&&a.push(parseInt(r));$("#grid").jqGrid("remapColumns",a,!0);var s=0;for(var r in e)"rn"!=e[r].name&&"cb"!=e[r].name&&null!=e[r].counter?$("#grid").jqGrid("setColProp",e[r].name,{frozen:r-s<i}):s++;c||$("#grid").jqGrid("setFrozenColumns"),$("#grid").trigger("reloadGrid");var n="undefined"!=typeof extraCustomize&&extraCustomize();grid.saveColumnConfiguration(function(){n&&(window.location.href=window.location.href)}),hideModal("popup")})},getGridConfig:function(){var t=new Array,e=$("#grid").jqGrid("getGridParam","colModel"),a=!1,o=0,i=0;for(var r in e)"rn"!=e[r].name&&"cb"!=e[r].name&&"counter"in e[r]&&!("alwayshidden"in e[r])?(t.push([e[r].name,e[r].hidden,e[r].width]),e[r].frozen&&(i=parseInt(r)+1-o)):"columns"==e[r].name||"graph"==e[r].name?a=!0:o++;var s={rows:t},n=$("#grid").getGridParam("postData").filters;void 0!==n&&n.rules!=[]&&(s.filter=n);var l=$("#grid").getGridParam("sortname");if(""!==l&&(s.sidx=l,s.sord=$("#grid").getGridParam("sortorder")),a)for(var r in s.crosses=[],cross_idx)s.crosses.push(cross[cross_idx[r]].key);else s.frozen=i;return s},saveColumnConfiguration:function(t,e){var a,o=new Array,i=$("#grid").jqGrid("getGridParam","colModel"),r=0,s=!1,n=0,l=$("#grid").jqGrid("getGridParam","page");for(var d in"string"==typeof t?(t.indexOf("next")>=0?++l:t.indexOf("prev")>=0?--l:t.indexOf("last")>=0?l=$("#grid").jqGrid("getGridParam","lastpage"):t.indexOf("first")>=0?l=1:t.indexOf("user")>=0&&(l=$("input.ui-pg-input").val()),$("#save, #undo").addClass("btn-primary").removeClass("btn-danger").prop("disabled",!0)):void 0!==e&&"operationplans"==i[e].name&&gantt.redraw(),i)"rn"!=i[d].name&&"cb"!=i[d].name&&"counter"in i[d]&&!("alwayshidden"in i[d])?(o.push([i[d].name,i[d].hidden,i[d].width]),i[d].frozen&&(r=parseInt(d)+1-n)):"columns"==i[d].name?(s=!0,a=i[d].width):"graph"==i[d].name?s=!0:n++;var c={[reportkey]:{rows:o,page:l,favorites:favorites}},p=$("#grid").getGridParam("postData"),u=p?p.filters:initialfilter;void 0!==u&&u.rules!=[]&&(c[reportkey].filter=u);var f=$("#grid").getGridParam("sortname");if(""!==f&&(c[reportkey].sidx=f,c[reportkey].sord=$("#grid").getGridParam("sortorder")),s){for(var d in c[reportkey].crosses=[],cross_idx)c[reportkey].crosses.push(cross[cross_idx[d]].key);a&&(c[reportkey].label_width=a)}else c[reportkey].frozen=r;if("function"==typeof extraPreference){var h=extraPreference();for(var g in h)c[reportkey][g]=h[g]}if("undefined"!=typeof url_prefix)var m=url_prefix+"/settings/";else m="/settings/";grid._cached_cross=null,$.ajax({url:m,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(c),success:function(){preferences=c[reportkey],"function"==typeof t&&t()},error:ajaxerror})},afterEditCell:function(t,e,a,o,i){$(document.getElementById(o+"_"+e)).trigger("select")},showExport:function(t,e){hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid");var a=!0,o='<div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title text-capitalize-first">'+gettext("Export CSV or Excel file")+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="'+gettext("Close")+'"></button></div><div class="modal-body">';if(t?o+='<div class="row" id="csvformat"><div class="col"><p class="fw-bold">'+gettext("Export format")+'</p><div class="form-check"><input class="form-check-input" id="spreadsheetlist" type="radio" name="csvformat" value="spreadsheetlist" checked=""><label class="form-check-label" for="spreadsheetlist">'+gettext("Spreadsheet list")+'</label></div><div class="form-check"><input class="form-check-input" id="csvlist" type="radio" name="csvformat" value="csvlist"><label class="form-check-label" for="csvlist">'+gettext("CSV list")+'</label></div><p class="fw-bold mt-3">'+gettext("Data source URL")+'&nbsp;&nbsp;<a href="'+documentation+'user-interface/getting-around/exporting-data.html" target="_blank" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="'+gettext("Using this link external applications can pull data from frePPLe")+'"><span class="fa fa-question-circle"></span></a><p><div class="input-group"><input type="text" readonly id="urladdress" class="input-group-text" style="background: white"><span class="input-group-text fa fa-clipboard" id="copybutton" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="'+gettext("Copy to clipboard")+'"</span></div></div>':t?a=!1:o+='<div class="row" id="csvformat"><div class="col"><p class="fw-bold">'+gettext("Export format")+'</p><div class="form-check"><input class="form-check-input" id="spreadsheettable" type="radio" name="csvformat" value="spreadsheettable" checked=""><label class="form-check-label" for="spreadsheettable">'+gettext("Spreadsheet table")+'</label></div><div class="form-check"><input class="form-check-input" id="spreadsheetlist" type="radio" name="csvformat" value="spreadsheetlist"><label class="form-check-label" for="spreadsheetlist">'+gettext("Spreadsheet list")+'</label></div><div class="form-check"><input class="form-check-input" id="csvtable" type="radio" name="csvformat" value="csvlist"><label class="form-check-label" for="csvtable">'+gettext("CSV table")+'</label></div><div class="form-check"><input class="form-check-input" id="csvlist" type="radio" name="csvformat" value="csvlist"><label class="form-check-label" for="csvlist">'+gettext("CSV list")+'</label></div><p class="fw-bold mt-3">'+gettext("Data source URL")+'&nbsp;&nbsp;<a href="'+documentation+'user-interface/getting-around/exporting-data.html" target="_blank" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="'+gettext("Using this link external applications can pull data from frePPLe")+'"><span class="fa fa-question-circle"></span></a><p><div class="input-group"><input type="text" readonly id="urladdress" class="input-group-text" style="background: white"><span class="input-group-text fa fa-clipboard" id="copybutton" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="'+gettext("Copy to clipboard")+'"</span></div></div>',a){if(e.length>0){o+='<div class="col"><p class="fw-bold">'+gettext("Scenarios to export")+'</p><div class="check" name="scenarios" id="scenarios" value="default">';for(var i=0;i<e.length;i++)1==e[i][2]&&(o+='<div class="form-check" style="white-space: nowrap"><input class="form-check-input" type="checkbox" value="" id="'+e[i][0]+'" checked disabled>&nbsp;&nbsp;&nbsp;<label class="form-check-label" for="'+e[i][0]+'">'+escapeAttribute(e[i][1])+"</label></div>");for(i=0;i<e.length&&i<6;i++)1!=e[i][2]&&(o+='<div class="form-check" style="white-space: nowrap"><input class="form-check-input" type="checkbox" value="" id="'+e[i][0]+'">&nbsp;&nbsp;&nbsp;<label class="form-check-label" for="'+e[i][0]+'">'+escapeAttribute(e[i][1])+"</label></div>");o+="</div></div>"}o+='</div></div><div class="modal-footer justify-content-between"><input type="submit" id="cancelbutton" role="button" class="btn btn-gray" data-bs-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" id="exportbutton" role="button" class="btn btn-primary" value="'+gettext("Export")+'"></div></div></div>',$("#popup").html(o),showModal("popup")}r();for(i=0;i<e.length&&i<6;i++)1!=e[i][2]&&$("#"+e[i][0]).on("click",function(){r()});function r(){var t=-1!=location.href.indexOf("#")?location.href.substr(0,location.href.indexOf("#")):location.href;location.search.length>0?t+="&":"?"!=t.charAt(t.length-1)&&(t+="?"),t+="format=spreadsheetlist",t+="&selected_rows=";var a=$("#grid").jqGrid("getGridParam","colModel"),o=!0,i=!1;for(var r in a)"columns"!=a[r].name&&"graph"!=a[r].name||(i=!0),!("rn"!=a[r].name&&"cb"!=a[r].name&&"counter"in a[r])||"alwayshidden"in a[r]||a[r].hidden||(o?o=!1:t+=",",t+=a[r].name);var s=$("#grid").getGridParam("postData"),n=s?s.filters:initialfilter;void 0!==n&&n.rules!=[]&&(t+="&filters="+n),t+="&language="+document.documentElement.lang;var l=$("#grid").getGridParam("sortname");if(""!==l&&(t+="&sidx="+l,t+="&sord="+$("#grid").getGridParam("sortorder")),i){o=!0;for(var r in cross_idx)o?(t+="&selected_crosses=",o=!1):t+=",",t+=cross[cross_idx[r]].key}if(e.length>1){var d=!0,c="";for(r=0;r<e.length;r++)$("#"+e[r][0]).is(":checked")&&(d?d=!1:c+=",",c+=e[r][0]);t+="&scenarios="+c}$("#urladdress").val(t)}$("#copybutton").on("click",function(){r(),navigator.clipboard.writeText($("#urladdress").val())}),$("#exportbutton").on("click",function(){var t=-1!=location.href.indexOf("#")?location.href.substr(0,location.href.indexOf("#")):location.href,a="";if(e.length>1)for(var o=!0,i=0;i<e.length;i++)$("#"+e[i][0]).is(":checked")&&(o?o=!1:a+=",",a+=e[i][0]);location.search.length>0?t+="&format="+$("#csvformat input:radio:checked").val():"?"==t.charAt(t.length-1)?t+="format="+$("#csvformat input:radio:checked").val():t+="?format="+$("#csvformat input:radio:checked").val(),e.length>1&&(t+="&scenarios="+a);var r=$("#grid").jqGrid("getGridParam","postData");t+="&"+jQuery.param(r),window.open(t,"_blank"),hideModal("popup")})},showBucket:function(){hideModal("popup"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#okbutton").on("click",function(){$("#horizonbuckets").val()+"|"+$("#horizonstart").val()+"|"+$("#horizonend").val()+"|"+($("#horizontype").is(":checked")?"True":"False")+"|"+$("#horizonbefore").val()+"|"+$("#horizonlength").val()+"|"+$("#horizonunit").val()==$("#horizonoriginal").val()?hideModal("timebuckets"):($.ajax({type:"POST",url:url_prefix+"/horizon/",data:{horizonbuckets:$("#horizonbuckets").val()?$("#horizonbuckets").val():$("#horizonbucketsul li a").first().text(),horizonstart:$("#horizonstart").val(),horizonend:$("#horizonend").val(),horizontype:$("#horizontype").is(":checked")?"1":"0",horizonlength:$("#horizonlength").val(),horizonbefore:$("#horizonbefore").val(),horizonunit:$("#horizonunit").val()},dataType:"text/html",async:!1}),window.location.href=window.location.href)}),showModal("timebuckets",!1)},showDelete:function(t){if(!$("#delete_selected").is(":disabled")){var e=jQuery("#grid").jqGrid("getGridParam","selarrrow");1==e.length&&"undefined"==typeof dont_show_related_objects_for_deletion?location.href=t+admin_escape(e[0])+"/delete/":e.length>0&&(hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title text-capitalize-first">'+gettext("Delete data")+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></span></button></div><div class="modal-body"><p>'+interpolate(gettext("You are about to delete %s objects AND ALL RELATED RECORDS!"),[e.length],!1)+'</p></div><div class="modal-footer justify-content-between"><input type="submit" id="cancelbutton" role="button" class="btn btn-gray pull-left" data-bs-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" id="delbutton" role="button" class="btn btn-primary pull-right" value="'+gettext("Confirm")+'"></div></div></div>'),showModal("popup"),$("#delbutton").on("click",function(){$.ajax({url:t,data:JSON.stringify([{delete:e}]),type:"POST",contentType:"application/json",success:function(){$("#delete_selected, #copy_selected, #edit_selected").prop("disabled",!0),$(".cbox, #cb_grid.cbox").prop("checked",!1),$("#grid").trigger("reloadGrid"),hideModal("popup")},error:function(t,e,a){401!=t.status?($("#popup .modal-body p").html(t.responseText),$("#popup .modal-title").html(gettext("Error")),$("#popup .modal-header").addClass("bg-danger"),$("#delbutton").prop("disabled",!0).hide()):location.reload()}})}))}},showCopy:function(){if(!$("#copy_selected").is(":disabled")){var t=jQuery("#grid").jqGrid("getGridParam","selarrrow");t.length>0&&(hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title text-capitalize-first">'+gettext("Copy data")+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><p>'+interpolate(gettext("You are about to duplicate %s objects"),[t.length],!1)+'</p></div><div class="modal-footer justify-content-between"><input type="submit" id="cancelbutton" role="button" class="btn btn-gray" data-bs-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" id="copybutton" role="button" class="btn btn-primary" value="'+gettext("Confirm")+'"></div></div></div>'),showModal("popup"),$("#copybutton").on("click",function(){$.ajax({url:location.pathname,data:JSON.stringify([{copy:t}]),type:"POST",contentType:"application/json",success:function(){$("#delete_selected, #copy_selected, #edit_selected").prop("disabled",!0),$(".cbox, #cb_grid.cbox").prop("checked",!1),$("#grid").trigger("reloadGrid"),hideModal("popup")},error:function(t,e,a){401!=t.status?($("#popup .modal-body p").html(t.responseText),$("#popup .modal-title").html(gettext("Error")),$("#popup .modal-header").addClass("bg-danger"),$("#copybutton").prop("disabled",!0).hide()):location.reload()}})}))}},showFilter:function(t,e,a){$("#addsearch").val(""),$("#filteroperand, #filterfield, #andordropdown").remove(),grid.handlerinstalled=!1,hideModal("popup"),hideModal("timebuckets");var o=void 0!==t?t:"grid",i=$("#"+o),r=$(void 0!==e?e:"#curfilter");hideModal("timebuckets"),hideModal("popup"),i.jqGrid("searchGrid",{closeOnEscape:!0,multipleSearch:!0,multipleGroup:!0,overlay:0,resize:!1,sopt:["eq","ne","lt","le","gt","ge","bw","bn","in","ni","ew","en","cn","nc","ico"],onSearch:function(){var t=$("#fbox_"+o).jqFilter("filterData");grid.saveColumnConfiguration(),grid.getFilterGroup(i,t,!0,r),"function"==typeof extraSearchUpdate&&extraSearchUpdate(t)},onReset:function(){return"undefined"!=typeof initialfilter?(i.jqGrid("getGridParam","postData").filters=JSON.stringify(initialfilter),grid.getFilterGroup(i,initialfilter,!0,r)):r.html(""),grid.saveColumnConfiguration(),!0}}),$("#searchmodfbox_grid").detach().appendTo("#content-main")},resetFilter:function(){$("undefined"!=typeof curfilterid?curfilterid:"#curfilter").html(""),$("#grid").setGridParam({postData:{filters:""},search:!0}).trigger("reloadGrid"),grid.saveColumnConfiguration()},countFilters:0,handlerinstalled:!1,addFilter:function(t){if(t){t.stopPropagation(),t.preventDefault();var e=$(t.target).attr("data-filterfield")}else e=$("#filterfield [data-filterfield]").first().attr("data-filterfield");var a={field:e,op:"cn",data:$("#addsearch").val(),filtercount:++grid.filtercount},o=$("#grid").getGridParam("postData");(o=void 0!==o?o.filters:initialfilter)&&""!==o?void 0!==(o=JSON.parse(o)).rules&&o.rules.length>0||void 0!==o.groups&&o.groups.length>0?o.rules.push(a):o={groupOp:"AND",rules:[a],groups:[o]}:o={groupOp:"AND",rules:[a],groups:[]},$("#grid").setGridParam({postData:{filters:JSON.stringify(o)},search:!0}).trigger("reloadGrid"),grid.saveColumnConfiguration(),"function"==typeof extraSearchUpdate&&extraSearchUpdate(o),grid.getFilterGroup($("#grid"),o,!0,$("#curfilter")),$(document).off("click",grid.clickFilter),grid.handlerinstalled=!1,$("#addsearch").val(""),$("#filteroperand, #filterfield, #andordropdown").remove(),$("#tooltip").css("display","none")},clickFilter:function(t){"addsearch"!=$(t.target).attr("id")&&($(document).off("click",grid.clickFilter),grid.handlerinstalled=!1,$("#addsearch").val(""),$("#filteroperand, #filterfield, #andordropdown").remove())},setFilterField:function(t,e,a,o){const i=$(t.target).closest(".badge"),r=$(t.target).attr("data-filterfield"),s=$(t.target).attr("data-filterlabel");let n=i.find("span[data-operandname]").attr("data-operandname"),l=grid.findOperandLabel(n);const d=$("#grid").jqGrid("getGridParam","colModel").filter(t=>t.name==r)[0].searchoptions;e.field!=r&&(i.find("span[data-colname]").attr("data-colname",r).attr("data-collabel",s).text(s),e.field=r,-1==d.sopt.indexOf(n)&&(n=d.sopt[0],l=grid.findOperandLabel(n),i.find("span[data-operandname]").attr("data-operandname",n).text(l),e.op=n),$("#filteroperand, #filterfield, #andordropdown").remove(),$("#grid").setGridParam({postData:{filters:JSON.stringify(o)},search:!0}).trigger("reloadGrid"),grid.saveColumnConfiguration())},setFilterOperand:function(t,e,a,o){const i=$(t.target).closest(".badge");let r=$(t.target).attr("data-operandname"),s=grid.findOperandLabel(r);r!=e.oper&&(i.find("span[data-operandname]").attr("data-operandname",r).text(s),e.op=r,$("#filteroperand, #filterfield, #andordropdown").remove(),$("#grid").setGridParam({postData:{filters:JSON.stringify(o)},search:!0}).trigger("reloadGrid"),grid.saveColumnConfiguration())},setFilterAndOr:function(t,e,a,o){const i=$(t.target);t.stopPropagation(),$("#filteroperand, #filterfield, #andordropdown").remove(),andordropdown=$('<span id="andordropdown" class="mt-1 list-group dropdown-menu" style="min-width: 1em"><a class="dropdown-item" data-oper="and">'+gettext("and")+'</a><a class="dropdown-item" data-oper="or">'+gettext("or")+"</a></span>"),andordropdown.on("click",t=>{const i=$(t.target).attr("data-oper");if("and"==i)e.groupOp="AND";else{if("or"!=i)return;e.groupOp="OR"}$("#filteroperand, #filterfield, #andordropdown").remove(),$("#grid").setGridParam({postData:{filters:JSON.stringify(o)},search:!0}).trigger("reloadGrid"),grid.saveColumnConfiguration(),grid.getFilterGroup($("#grid"),o,!0,a,o)}),i.append(andordropdown)},showFieldList:function(t,e,a,o){$.jgrid.hideModal("#searchmodfbox_grid"),$("#filteroperand, #filterfield, #andordropdown").remove(),event.stopPropagation(),$(document).on("click",grid.clickFilter);let i=$('<span id="filterfield" class="list-group dropdown-menu">'),r=15;for(var s of $("#grid").jqGrid("getGridParam","colModel")){var n=s.searchoptions;if(n&&n.sopt){if("addsearch"==t.id)var l=$('<a class="dropdown-item" onclick="grid.addFilter(event)" />');else(l=$('<a class="dropdown-item" />')).on("click",t=>grid.setFilterField(t,e,a,o));if(l.attr("data-filterfield",s.name),l.attr("data-filterlabel",s.label),l.html(s.label),i.append(l),--r<=0)break}}$(t).before(i)},showOperandsList:function(t,e,a,o){$.jgrid.hideModal("#searchmodfbox_grid"),$("#filteroperand, #filterfield, #andordropdown").remove(),event.stopPropagation(),$(document).on("click",grid.clickFilter);let i=$(t).closest(".badge").find("span[data-colname]").attr("data-colname"),r=$("#grid").jqGrid("getGridParam","colModel").filter(t=>t.name==i)[0],s=$('<span id="filteroperand" class="list-group dropdown-menu">'),n=r.searchoptions;if(n&&n.sopt){for(let t of n.sopt){let i=$('<a class="dropdown-item"/>');i.on("click",t=>grid.setFilterOperand(t,e,a,o)),i.attr("data-operandname",t),i.html(grid.findOperandLabel(t)),s.append(i)}$(t).before(s)}},findOperandLabel(t){for(const e of $.jgrid.locales[$.jgrid.defaults.locale].search.odata)if(e.oper==t)return e.text;return t},keyDownSearch:function(){13==(event.keyCode?event.keyCode:event.which)&&grid.addFilter()},updateFilter:function(t,e,a){if(t instanceof Array)for(var o in t)grid.updateFilter(t[o],e,a);else if("object"==typeof t)for(var o in t)"filtercount"==o&&t[o]==e?t.data=a:t.hasOwnProperty(o)&&grid.updateFilter(t[o],e,a)},removeFilter:function(t,e){if(t instanceof Array)for(var a in t)t[a].filtercount==e?t.splice(a,1):t[a].filtercount>e?--t[a].filtercount:grid.removeFilter(t[a],e);else if("object"==typeof t)for(var a in t)t.hasOwnProperty(a)&&grid.removeFilter(t[a],e)},getFilterRule:function(t,e,a,o){var i,r,s=t.jqGrid("getGridParam","colModel");for(i=0;i<s.length;i++)if(s[i].name===e.field||s[i].field_name===e.field){r=s[i];break}if(void 0!=r){var n=$("<span data-colname="+r.name+" data-collabel="+r.label+' style="cursor: pointer">'+r.label+"</span>");n.on("click",t=>grid.showFieldList(t.target,e,a,o));var l=$("<span data-operandname="+e.op+' style="cursor: pointer;">'+grid.findOperandLabel(e.op)+"</span>");l.on("click",t=>grid.showOperandsList(t.target,e,a,o));var d=$('<span class="badge dropdown"></span>');d.append(n),d.append("&nbsp;"),d.append(l),d.append("&nbsp;");var c=$('<input class="form-control" style="width: 2.4em">');e.filtercount=grid.countFilters++,c.val(e.data),c.attr("style","width: "+Math.min(.5*(e.data.length+4),20)+"em"),c.on({input:function(t){this.style.width=Math.min(.5*($(t.target).val().length+4),20)+"em"},change:function(a){grid.updateFilter(o,e.filtercount,$(a.target).val()),t.setGridParam({postData:{filters:JSON.stringify(o)},search:!0}).trigger("reloadGrid"),"function"==typeof extraSearchUpdate&&extraSearchUpdate(o),grid.saveColumnConfiguration()}}),d.append(c),d.append("&nbsp;");var p=$('<span class="fa fa-times"/>');p.on("click",function(i){grid.removeFilter(o,e.filtercount),grid.getFilterGroup(t,o,!0,a,o),t.setGridParam({postData:{filters:JSON.stringify(o)},search:!0}).trigger("reloadGrid"),"function"==typeof extraSearchUpdate&&extraSearchUpdate(o),grid.saveColumnConfiguration()}),d.append(p),a.append(d)}},getFilterGroup:function(t,e,a,o,i){if(a?(o.html(""),i=e,grid.countFilters=0):o.append("( "),null!==e&&void 0!==e&&void 0!==e.groups)for(var r=0;r<e.groups.length;r++){if(o.html().length>2)(s=$('<span class= "d-inline-block dropdown p-1" style="cursor: pointer"><span class="dropdown-toggle">'+gettext("OR"===e.groupOp?"or":"and ")+"</span></span>")).on("click",t=>grid.setFilterAndOr(t,e,o,i)),o.append(s);grid.getFilterGroup(t,e.groups[r],!1,o,i)}if(null!==e&&void 0!==e&&void 0!==e.rules)for(r=0;r<e.rules.length;r++){var s;if(o.html().length>2)(s=$('<span class="d-inline-block dropdown p-1" style="cursor: pointer"><span>'+gettext("OR"===e.groupOp?"or":"and")+"</span></span>")).on("click",t=>grid.setFilterAndOr(t,e,o,i)),o.append(s);grid.getFilterRule(t,e.rules[r],o,i)}a||o.append("&nbsp;)")},markSelectedRow:function(t){void 0!==t&&t>0?($("#delete_selected, #copy_selected, #edit_selected").prop("disabled",!1),$("#actions").length&&$("#actions1").prop("disabled",!1)):($("#delete_selected, #copy_selected, #edit_selected").prop("disabled",!0),$("#actions").length&&$("#actions1").prop("disabled",!0))},markAllRows:function(){$(this).is(":checked")?($("#copy_selected, #delete_selected, #edit_selected").prop("disabled",!1),$("#gridactions").prop("disabled",!1),$(".cbox").prop("checked",!0)):($("#copy_selected, #delete_selected, #edit_selected").prop("disabled",!0),$("#gridactions").prop("disabled",!0),$(".cbox").prop("checked",!1))},displayMode:function(t){var e=-1!=location.href.indexOf("#")?location.href.substr(0,location.href.indexOf("#")):location.href;location.search.length>0?e=e.replace("&mode=table","").replace("&mode=graph","").replace("mode=table","").replace("mode=graph","")+"&mode="+t:"?"==e.charAt(e.length-1)?e+="mode="+t:e+="?mode="+t,window.location.href=e},findCrossByName:function(t){for(var e in cross)if(cross[e].key==t)return parseInt(e);return-1},expandCross:function(t,e){var a=[];if($(t).hasClass("fa-plus-square-o")){var o=[e];for(var i of cross[e].expand){(r=grid.findCrossByName(i))>0&&o.push(r)}for(var r of cross_idx)r==e?a=a.concat(o):o.includes(r)||a.push(r)}else for(var r of cross_idx)if(cross[e].expand&&!cross[e].expand.includes(cross[r].key)){var s=!0;for(var i of cross[e].expand){var n=grid.findCrossByName(i);cross[n].expand&&cross[n].expand.includes(cross[r].key)&&(s=!1)}s&&a.push(r)}$(t).toggleClass("fa-plus-square-o").toggleClass("fa-minus-square-o"),cross_idx=a;var l=$("#grid");l.jqGrid("setFrozenColumns"),l.trigger("reloadGrid"),l.setGridWidth($("#content-main").width()),grid.saveColumnConfiguration()},showUpdate:function(t){hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid");var e=$("#grid"),a=e.jqGrid("getGridParam","colModel").sort((t,e)=>(t.label||"").localeCompare(e.label||"")),o=e.jqGrid("getGridParam","selarrrow"),i=o.length,r={update:{fields:{}}};if(i&&i!=e.jqGrid("getGridParam","reccount"))r.update.pk=o;else{i=e.jqGrid("getGridParam","records");var s=$("#grid").getGridParam("postData");r.update.filter=s?void 0!==s.filters&&s.filters.rules!=[]?JSON.parse(s.filters):{}:initialfilter}var n='<div class="modal-dialog modal-lg"><div class="modal-content">';for(var l of(n+='<div class="modal-header"><h5 class="modal-title">'+interpolate(gettext("Update %s records"),[i])+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label='+gettext("Close")+'></button></div><div class="modal-body">',n+='<div class="row mb-3"><div class="col">'+gettext("This form allows you update fields for many records.")+"</div></div>",n+='<div class="row d-none mb-3" id="updatefieldtemplate"><div class="col"><select class="form-select">',a))l.editable&&(n+='<option value="'+l.name+'">'+l.label+"</option>");for(var l of(n+='</select></div><div class="col"><input class="form-control" type="text" placeholder="'+gettext("update to")+'"></div><div class="col-auto"><button class="btn btn-sm btn-primary" onclick="grid.deleteUpdateField(event)"><span class="fa fa-trash-o" data-bs-toggle="tooltip" data-bs-placement="top"data-bs-title="'+gettext("Delete")+'"></span></button></div></div>',n+='<div class="row mb-3 updatefield"><div class="col"><select class="form-select">',a))l.editable&&(n+='<option value="'+l.name+'">'+l.label+"</option>");n+='</select></div><div class="col"><input class="form-control" type="text" placeholder="'+gettext("update to")+'"></div><div class="col-auto"><button class="btn btn-sm btn-primary" onclick="grid.deleteUpdateField(event)"><span class="fa fa-trash-o" data-bs-toggle="tooltip" data-bs-placement="top"data-bs-title="'+gettext("Delete")+'"></span></button></div></div>',n+='<div class="row"><div class="col-auto ms-auto"><button class="btn btn-sm btn-primary" id="addCustbutton" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Add"><span class="fa fa-plus"></span></button></div></div>',n+='</div><div class="modal-footer justify-content-between"><input type="submit" id="cancelCustbutton" role="button" class="btn btn-gray" data-bs-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" id="updateCustbutton" role="button" class="btn btn-primary" value="'+gettext("Update")+'"></div></div></div>',$("#popup").html(n),showModal("popup"),$("#addCustbutton").on("click",function(t){var e=$("#updatefieldtemplate").clone();e.removeAttr("id"),e.insertBefore($(t.target).closest(".row")),e.toggleClass("d-none updatefield"),bootstrap.Tooltip.getOrCreateInstance(e.find('[data-bs-toggle="tooltip"]')[0]),t.preventDefault()}),$("#updateCustbutton").on("click",function(){for(var e of $("div.modal-body .updatefield")){var a=$(e).find("select :selected").val(),o=$(e).find("input.form-control").val();r.update.fields[a]=""==o?null:o}$.ajax({url:t,data:JSON.stringify(r),type:"POST",contentType:"application/json",success:function(){window.location.href=window.location.href},error:ajaxerror})})},deleteUpdateField:function(t){$(t.target).closest(".row").remove(),t.preventDefault()}},favorite={check:function(){var t=$("#favoritename").val();return t.length>0&&("undefined"!=typeof favorites&&!(t in favorites)||"undefined"!=typeof preferences&&!("favorites"in preferences)||"undefined"!=typeof preferences&&"favorites"in preferences&&!(t in preferences.favorites))?($("#favoritesave").prop("disabled",!1),!0):($("#favoritesave").prop("disabled",!0),!1)},save:function(){var t=$("#favoritename").val();if(favorite.check()){favorites[t]=grid.getGridConfig(),grid.saveColumnConfiguration();var e=$("#favoritelist li.divider");0==e.length&&($("#favoritelist").prepend('<li role="separator" class="divider"></li>'),e=$("#favoritelist li.divider"));var a=$("<li></li>"),o=$('<a class="dropdown-item" href="#" onclick="favorite.open(event)"></a>');o.text(t),o.append('<div style="float:right"><span class="fa fa-trash-o" onclick="favorite.remove(event)"></span></div>'),a.append(o),e.before(a),favorite.check()}},remove:function(t){var e=$(t.target).closest("a").text();e in favorites&&confirm(gettext("Click ok to confirm deleting the favorite"))&&(delete favorites[e],grid.saveColumnConfiguration(),$(t.target).closest("li").remove(),$("#favoritename").val(e),favorite.check()),t.stopImmediatePropagation()},open:function(t){var e=$(t.target).parent().text();if(e in favorites){var a=$("#grid"),o=!1,i=!1,r=0,s=a.jqGrid("getGridParam","colModel"),n=favorites[e].frozen;for(var l in s)"graph"==s[l].name?o=!0:"columns"==s[l].name?(i=!0,n=parseInt(l)):"cb"==s[l].name&&(r+=1);for(var d of(o||a.jqGrid("destroyFrozenColumns"),favorites[e].rows))d[1]?a.jqGrid("hideCol",d[0]):a.jqGrid("showCol",d[0]),a.jqGrid("setColWidth",d[0],d[2]);if("crosses"in favorites[e])for(var l of(cross_idx=[],favorites[e].crosses))for(var c in cross)cross[c].key==l&&cross_idx.push(parseInt(c));var p,u=[];for(var f of favorites[e].rows)f[1]||(u.push(f[0]),a.jqGrid("setColProp",f[0],{frozen:u.length<n+r}));if(i)for(var c of s)"counter"in c?c.frozen=!0:(u.push(c.name),c.frozen="columns"==c.name);for(var h of s)u.includes(h.name)||"cb"==h.name||u.push(h.name);a.jqGrid("remapColumnsByName",u,!0,!1),"filter"in favorites[e]&&""!=favorites[e].filter?(a.setGridParam({postData:{filters:favorites[e].filter},search:!0}),grid.getFilterGroup($("#grid"),JSON.parse(favorites[e].filter),!0,$("#curfilter"))):(a.setGridParam({postData:{filters:""},search:!0}),$("#curfilter").html("")),"sord"in favorites[e]&&"sidx"in favorites[e]?(a.setGridParam({sortname:favorites[e].sidx,sortorder:favorites[e].sord}),p=(favorites[e].sidx+" "+favorites[e].sord).split(",")):(a.setGridParam({sortname:"",sortorder:"asc"}),p=default_sort.split(","));var g=a.jqGrid("getGridParam");for(var h of g.colModel){(m=$("#"+g.id+"_"+h.name)).find("span.s-ico").css("display","none"),m.find("span.ui-grid-ico-sort").addClass("disabled"),m.find("span.ui-jqgrid-sort-order").html("&nbsp;"),h.lso=""}for(var h in p){var m,v=p[h].trim().split(" "),b=v[0].trim();(m=$("#"+g.id+"_"+b)).find("span.s-ico").css("display",""),"asc"==v[1].trim()?(m.find("span.ui-icon-asc").removeClass("disabled"),g.colModel[g.iColByName[b]].lso="asc-desc"):(m.find("span.ui-icon-desc").removeClass("disabled"),g.colModel[g.iColByName[b]].lso="desc-asc"),m.find("span.ui-jqgrid-sort-order").html(parseInt(h)+1)}o||a.jqGrid("setFrozenColumns"),a.trigger("reloadGrid"),a.setGridWidth($("#content-main").width()),grid.saveColumnConfiguration()}}},ERPconnection={IncrementalExport:function(t,e){var a=t.jqGrid("getGridParam","selarrrow");if(null!==a&&0!=a.length){var o=[];for(var i in a){var r=t.jqGrid("getRowData",a[i]);void 0===r.type&&(r.type=e),["proposed","approved","confirmed"].includes(r.status||r.operationplan__status)&&o.push(r)}o!=[]&&(hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title text-capitalize">'+gettext("Export")+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body pb-0"><p>'+gettext("Export selected records?")+'</p></div><div class="modal-footer justify-content-between"><input type="submit" id="cancelbutton" role="button" class="btn btn-gray text-capitalize" data-bs-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" id="button_export" role="button" class="btn btn-primary text-capitalize" value="'+gettext("Confirm")+'"></div></div></div>'),showModal("popup"),document.getElementById("popup").addEventListener("hidden.bs.modal",t=>{$("#noactionselected").prop("selected",!0)},{once:!0}),$("#button_export").on("click",function(){if($("#button_export").val()!==gettext("Close")){var e=gettext("connecting");$("#popup .modal-body p").html(String(e).charAt(0).toUpperCase()+String(e).slice(1)+"..."),$.ajax({url:url_prefix+"/erp/upload/",data:JSON.stringify(o),type:"POST",contentType:"application/json",success:function(e,o,i){if($("#cancelbutton").addClass("invisible"),$("#button_export").val(gettext("Close")),204==i.status)return $("#popup .modal-title").html(gettext("Error")),$("#popup .modal-header").addClass("bg-danger"),void $("#popup .modal-body p").html(gettext("No valid records selected"));var r=[];for(var s in $("#popup .modal-body p").html(gettext("Export successful")),a){var n=t.jqGrid("getCell",a[s],"operationplan__type");n||(n=t.jqGrid("getCell",a[s],"type"));var l=t.jqGrid("getCell",a[s],"operationplan__status");"proposed"!==l||["STCK","DLVR"].includes(n)?l||"proposed"!==(l=t.jqGrid("getCell",a[s],"operationplan__status"))||["STCK","DLVR"].includes(n)||(t.jqGrid("setCell",a[s],"status","approved"),(r=t.jqGrid("getRowData",a[s])).status="approved"):(t.jqGrid("setCell",a[s],"operationplan__status","approved"),(r=t.jqGrid("getRowData",a[s])).operationplan__status="approved")}t.jqGrid("setRowData",r),"function"==typeof checkrows&&checkrows(t,a)},error:function(t){401!=t.status?($("#popup .modal-title").html(gettext("Error")),$("#popup .modal-header").addClass("bg-danger"),$("#popup .modal-body p").html(t.responseText),$("#button_export").val(gettext("retry"))):location.reload()}})}else hideModal("popup")}),$("#actions").length&&$("#actions1 span").text($("#actionsul").children().first().text()))}},SODepExport:function(t,e){const a=t.jqGrid("getGridParam","selarrrow");if(null===a||0==a.length)return;const o=[];for(let i in a){let r=t.jqGrid("getRowData",a[i]);void 0===r.type&&(r.type=e),o.push(r)}const i=window.grid.formatNumber;hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog modal-xl"><div class="modal-content"><div class="modal-header"><h5 class="modal-title text-capitalize">'+gettext("Export")+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><p>'+gettext("Export selected records?")+'</p></div><div class="modal-footer justify-content-between"><input type="submit" id="cancelbutton" role="button" class="btn btn-gray" data-bs-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" id="button_export" role="button" class="btn btn-primary" value="'+gettext("Confirm")+'"></div></div></div>'),showModal("popup"),document.getElementById("popup").addEventListener("hidden.bs.modal",t=>{$("#noactionselected").prop("selected",!0)},{once:!0});let r="?demand=";for(let o=0;o<a.length;o++){const i=t.jqGrid("getRowData",a[o]);void 0===i.type&&(i.type=e),"open"!=i.status&&"proposed"!=i.status||(r+=0==o?encodeURIComponent(a[o]):"&demand="+encodeURIComponent(a[o]))}$.ajax({url:url_prefix+"/demand/operationplans/"+r,type:"GET",contentType:"application/json",success:function(e){if(0===e.PO.length&&0===e.MO.length&&0===e.DO.length)return $("#popup .modal-body").css({"overflow-y":"auto"}).html('<div style="overflow-y:auto; height: 300px; resize: vertical">'+gettext("There are no purchase, distribution or manufacturing orders for export that are linked to this sales order")+"</div>"),void $("#button_export").addClass("d-none");$("#popup .modal-body").html('<div id="PO-title"><h5 class="text-capitalize">'+gettext("purchase orders")+'</h5></div><div id="PO-data" class="table-responsive"><table class="table table-hover text-center" id="exporttable_PO"><thead class="thead-default"></thead></table></div><div id="MO-title"><h5 class="text-capitalize">'+gettext("manufacturing orders")+'</h5></div><div id="MO-data" class="table-responsive"><table class="table table-hover text-center" id="exporttable_MO"><thead class="thead-default"></thead></table></div><div id="DO-title"><h5 class="text-capitalize">'+gettext("distribution orders")+'</h5></div><div id="DO-data" class="table-responsive"><table class="table table-hover text-center" id="exporttable_DO"><thead class="thead-default"></thead></table></div>');let o=[],r=0;for(const t of["PO","DO","MO"]){if(0===e[t].length){$("#"+t+"-title, #"+t+"-data").addClass("d-none");continue}o.length=0;let a=$("<tr/>");a.append($("<th/>").html('<input id="cb_modaltableall_'+t+'" class="cbox" type="checkbox" aria-checked="true" checked>')),o.push(...e[t][0].map(t=>t[0]));for(const i in o)e[t][0][i][2]||a.append($("<th/>").addClass("text-capitalize").text(o[i]));const n=$("<tbody/>");for(let a=0;a<e[t].length;a++){const l=$("<tr/>").attr("orderreference",e[t][a][0][1]).attr("ordertype",t),d=$("<td/>");d.append($("<input/>").attr({id:"cb_modaltable_"+t+"-"+a,class:"cbox align-middle",type:"checkbox","aria-checked":"true",checked:"true"})),l.append(d);for(let n=0;n<o.length;n++)e[t][a][n][2]||("quantity"==e[t][a][n][0]?l.append($('<td class="align-middle"/><input type="number" value="'+parseFloat(e[t][a][n][1])+'" id="quantity'+r+'"/>')):"receipt date"===e[t][a][n][0]||"end date"===e[t][a][n][0]?l.append($('<td class="align-middle"/><input type="datetime-local" value="'+e[t][a][n][1]+'" title="due date" required="" id="due'+r+'"></modal_table_row_indexnput>')):"supplier"==e[t][a][n][0]?l.append($('<td class="align-middle"/><input type="text" value="'+e[t][a][n][1]+'" title="supplier" required="" id="supplier'+r+'"></input>')):l.append($('<td class="align-middle"/>').text("number"===(s=e[t][a][n])[3]?i(s[1]):"text"===s[3]?s[1]:"date"===s[3]?moment(s[1]).format(dateformat):s[1])));n.append(l),r++}$("#popup #exporttable_"+t).append(n),$("#popup #exporttable_"+t+" thead").append(a),$("#cb_modaltableall_"+t).click(function(){$("#cb_modaltableall_"+t).prop("checked")?$("#exporttable_"+t+" input[type=checkbox]").prop("checked",$(this).prop("checked")):($("#exporttable_"+t+" tbody tr input:not(:checked)").prop("checked",!0),$("#exporttable_"+t+" tbody tr input:not(:checked)").parent().parent().removeClass("active").addClass("active")),$("#exporttable_"+t+" input[type=checkbox]").prop("checked",$(this).prop("checked")),$("#popup .modal-body tbody input[type=checkbox]:checked").length>0?$("#button_export").prop("disabled",!1):$("#button_export").prop("disabled",!0)}),$("#exporttable_"+t+" tbody input[type=checkbox]").click(function(){$(this).parent().parent().toggleClass("selected"),$("#cb_modaltableall_"+t).prop("checked",0==$("#exporttable_"+t+" tbody input[type=checkbox]:not(:checked)").length),$("#popup .modal-body tbody input[type=checkbox]:checked").length>0?$("#button_export").prop("disabled",!1):$("#button_export").prop("disabled",!0)})}var s;$("#button_export").on("click",function(){const e=[];const o=$("#popup .modal-body tbody input[type=checkbox]:checked").parent().parent();index=0;for(const t of o){let a=".modal-body #due"+index,o=".modal-body #quantity"+index,i=".modal-body #supplier"+index;newDate=16===$(a).val().length?$(a).val()+":00":$(a).val(),e.push({reference:t.attributes.orderreference.value,type:t.getAttribute("ordertype"),quantity:Number($(o).val()),enddate:newDate,supplier:$(i).val()}),index++}$("#popup .modal-body").html(gettext("connecting")+"..."),$.ajax({url:url_prefix+"/erp/upload/",data:JSON.stringify(e),type:"POST",contentType:"application/json",success:function(){for(var e in $("#popup .modal-body").html(gettext("Export successful")),$("#cancelbutton").val(gettext("Close")),$("#button_export").prop("disabled",!0),a){"proposed"==t.jqGrid("getCell",a[e],"status")&&t.jqGrid("setCell",a[e],"status","approved")}},error:function(t,e,a){401!=t.status?($("#popup .modal-title").html(gettext("Error during export")),$("#popup .modal-header").addClass("bg-danger"),$("#popup .modal-body").css({"overflow-y":"auto"}).html('<div style="overflow-y:auto; height: 300px; resize: vertical">'+t.responseText+"</div>"),$("#button_export").val(gettext("Retry")),$("#popup .modal-dialog").css({visibility:"visible"}),$("#popup").modal("show")):location.reload()}})}),$("#actions").length&&$("#actions1 span").text($("#actionsul").children().first().text()),$("#DRPactions").length&&$("#DRPactions1 span").text($("#DRPactionsul").children().first().text())},error:function(t,e,a){401!=t.status?($("#popup .modal-title").html(gettext("Error")),$("#popup .modal-header").addClass("bg-danger"),$("#popup .modal-body").css({"overflow-y":"auto"}).html('<div style="overflow-y:auto; height: 300px; resize: vertical">'+t.responseText+"</div>"),$("#button_export").val(gettext("Retry")),$("#popup .modal-dialog").css({visibility:"visible"}),$("#popup").modal("show")):location.reload()}})}},widget={init:function(t){$(".widget-list").each(function(){Sortable.create($(this)[0],{group:"widgets",handle:".widget-handle",animation:100,onEnd:t})})},getConfig:function(){var t=[];return $(".widget-list").each(function(){var e={name:$(this).attr("data-widget")||"",cols:[{width:$(this).attr("data-widget-width")||12,widgets:[]}]};$(this).find(".widget").each(function(){e.cols[0].widgets.push([$(this).attr("data-widget")||"",{collapsed:0==$(this).find(".collapse.show").length}])}),t.push(e)}),t}},dashboard={dragAndDrop:function(){$(".cockpitcolumn").each(function(){Sortable.create($(this)[0],{group:"widgets",handle:".card-header",animation:100,onEnd:function(t){dashboard.save()},delay:1e3})}),$("#dashboard").each(function(){Sortable.create($(this)[0],{group:"cockpit",handle:"h1",animation:100,onEnd:function(t){dashboard.save()},delay:1e3})}),$(".panel-toggle").click(function(){var t=$(this);t.toggleClass("fa-minus fa-plus"),t.closest(".card").find(".card-body").toggle()}),$(".panel-close").click(function(){$(this).closest(".card").remove(),dashboard.save()})},save:function(t){var e=[];if($("[data-cockpit-row]").each(function(){var t=$(this).attr("data-cockpit-row"),a=[];$(".cockpitcolumn",this).each(function(){var t=12;$(this).hasClass("col-md-12")?t=12:$(this).hasClass("col-md-11")?t=11:$(this).hasClass("col-md-10")?t=10:$(this).hasClass("col-md-9")?t=9:$(this).hasClass("col-md-8")?t=8:$(this).hasClass("col-md-7")?t=7:$(this).hasClass("col-md-6")?t=6:$(this).hasClass("col-md-5")?t=5:$(this).hasClass("col-md-4")?t=4:$(this).hasClass("col-md-3")?t=3:$(this).hasClass("col-md-2")&&(t=2);var e=[];$("[data-cockpit-widget]",this).each(function(){e.push([$(this).attr("data-cockpit-widget"),{}])}),a.push({width:t,widgets:e})}),a.length>0&&e.push({rowname:t,cols:a})}),"undefined"!=typeof url_prefix)var a=url_prefix+"/settings/";else a="/settings/";$.ajax({url:a,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({"freppledb.common.cockpit":e}),success:function(){"string"===$.type(t)&&(window.location.href=window.location.href)},error:ajaxerror})},customize:function(t){var e="";$("[data-cockpit-row='"+t+"'] .cockpitcolumn").each(function(){""!=e&&(e+=" - "),$(this).hasClass("col-md-12")?e+="100%":$(this).hasClass("col-md-11")?e+="92%":$(this).hasClass("col-md-10")?e+="83%":$(this).hasClass("col-md-9")?e+="75%":$(this).hasClass("col-md-8")?e+="67%":$(this).hasClass("col-md-7")?e+="58%":$(this).hasClass("col-md-6")?e+="50%":$(this).hasClass("col-md-5")?e+="42%":$(this).hasClass("col-md-4")?e+="33%":$(this).hasClass("col-md-3")?e+="25%":$(this).hasClass("col-md-2")&&(e+="17%")});for(var a='<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">'+gettext("Customize a dashboard row")+'</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><form class="form-horizontal"><div class="row mb-3"><label class="col-3 col-form-label" for="id_name" class="col-form-label">'+gettext("Name")+':</label><div class="col-9"><input id="id_name" class="form-control" type="text" value="'+t+'"></div></div><div class="row mb-3"><label class="col-3 col-form-label" for="id_layout2" class="col-form-label">'+gettext("Layout")+':</label><div class="col-9 dropdown"><button class="form-control dropdown-toggle w-100" id="id_layout2" name="layout" type="button" data-bs-toggle="dropdown" aria-haspopup="true"><span id="id_layout">'+e+'</span>&nbsp;<span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="id_layout" id="id_layoutul"><li class="dropdown-header">'+gettext("Single column")+'</li><li><a class="dropdown-item" onclick="dashboard.setlayout(this)">100%</a></li><li class="divider"></li><li class="dropdown-header">'+gettext("Two columns")+'</li><li><a class="dropdown-item" onclick="dashboard.setlayout(this)">75% - 25%</a></li><li><a class="dropdown-item" onclick="dashboard.setlayout(this)">67% - 33%</a></li><li><a class="dropdown-item" onclick="dashboard.setlayout(this)">50% - 50%</a></li><li><a class="dropdown-item" onclick="dashboard.setlayout(this)">33% - 67%</a></li><li><a class="dropdown-item" onclick="dashboard.setlayout(this)">25% - 75%</a></li><li class="divider"></li><li class="dropdown-header">'+gettext("Three columns")+'</li><li><a class="dropdown-item" onclick="dashboard.setlayout(this)">50% - 25% - 25%</a></li><li><a class="dropdown-item" onclick="dashboard.setlayout(this)">33% - 33% - 33%</a></li><li class="divider"></li><li class="dropdown-header">'+gettext("Four columns")+'</li><li><a class="dropdown-item" onclick="dashboard.setlayout(this)">25% - 25% - 25% - 25%</a></li></ul></div></div><div class="row mb-3"><label class="col-3 col-form-label" for="id_widget2" class="col-form-label">'+gettext("Add widget")+':</label><div class="col-9 dropdown"><button class="form-control dropdown-toggle w-100" id="id_widget2" type="button" data-bs-toggle="dropdown"><span id="id_widget">-</span>&nbsp;<span class="caret"></span></button><ul class="dropdown-menu col-9" aria-labelledby="id_widget2" id="id_widgetul">',o=hiddenwidgets.length,i=0;i<o;i++)a+='<li><a class="dropdown-item" onclick="dashboard.setwidget('+i+')">'+hiddenwidgets[i][1]+"</a></li>";a+='</ul></div><span id="newwidgetname" style="display:none"></span></div></form></div><div class="modal-footer"><input type="submit" role="button" onclick=\'hideModal("popup")\' class="btn btn-gray pull-left" data-bs-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" role="button" onclick=\'dashboard.saveCustomization("'+t+'")\' class="btn btn-primary pull-right" value="'+gettext("Save")+'"><input type="submit" role="button" onclick=\'dashboard.addRow("'+t+'", false)\' class="btn btn-primary pull-right" value="'+gettext("Add new below")+'"><input type="submit" role="button" onclick=\'dashboard.addRow("'+t+'", true)\' class="btn btn-primary pull-right" value="'+gettext("Add new above")+'"><input type="submit" role="button" onclick=\'dashboard.deleteRow("'+t+'")\' class="btn btn-danger pull-right" value="'+gettext("Delete")+'"></div></div></div></div>',$("#popup").html(a),showModal("popup")},setlayout:function(t){$("#id_layout").text($(t).text())},setwidget:function(t){$("#id_widget").text(hiddenwidgets[t][1]),$("#newwidgetname").text(hiddenwidgets[t][0])},saveCustomization:function(t){var e=$("#id_name").val();if(t!=e){for(var a=2;$("[data-cockpit-row='"+e+"']").length>1;)e=$("#id_name").val()+" - "+a++;$("[data-cockpit-row='"+t+"'] .col-md-11 h1").text(e),$("[data-cockpit-row='"+t+"'] h1 button").attr("onclick","dashboard.customize('"+e+"')"),$("[data-cockpit-row='"+t+"'] .horizontal-form").attr("id",e),$("[data-cockpit-row='"+t+"']").attr("data-cockpit-row",e)}var o=$("#id_layout").text().split("-"),i=0,r=null;for($("[id='"+t+"'] .cockpitcolumn").each(function(){i<o.length?(r=this,$(this).removeClass("col-md-1 col-md-2 col-md-3 col-md-4 col-md-5 col-md-6 col-md-7 col-md-8 col-md-9 col-md-10 col-md-11 col-md-12"),$(this).addClass("col-md-"+Math.round(.12*parseInt(o[i])))):($("[data-cockpit-widget]",this).appendTo(r),$(this).remove()),i++});i<o.length;)r=$('<div class="cockpitcolumn col-md-'+Math.round(.12*parseInt(o[i]))+' col-sm-12"></div>').insertAfter(r),i++;var s=$("#newwidgetname").text();""!=s?($('<div class="card"></div>').attr("data-cockpit-widget",s).appendTo(r),dashboard.save("true")):dashboard.save(),dashboard.dragAndDrop(),hideModal("popup")},deleteRow:function(t){$("[data-cockpit-row='"+t+"']").remove(),dashboard.save(),hideModal("popup")},addRow:function(t,e){for(var a=$("#id_name").val(),o=2;$("[data-cockpit-row='"+$.escapeSelector(a)+"']").length>=1;)a=$("#id_name").val()+" - "+o++;for(var i='<div class="row" data-cockpit-row="'+a+'"><div class="col-md-11"><h1 style="float: left">'+a+'</h1></div><div class="col-md-1"><h1 class="pull-right"><button class="btn btn-sm btn-primary" onclick="dashboard.customize(\''+a+'\')" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="'+gettext("Customize")+'"><span class="fa fa-wrench"></span></button></h1></div><div class="horizontal-form" id="'+a+'">',r=$("#id_layout").text().split("-"),s=$("#newwidgetname").text(),n=0;n<r.length;n++)i+='<div class="cockpitcolumn col-md-'+Math.round(.12*parseInt(r[n]))+' col-sm-12">',0==n&&""!=s&&(i+='<div class="card" data-cockpit-widget="'+s+'"></div>'),i+="</div>";i+="</div></div></div>",e?$("[data-cockpit-row='"+$.escapeSelector(t)+"']").first().before($(i)):$("[data-cockpit-row='"+$.escapeSelector(t)+"']").last().after($(i)),""!=s?dashboard.save("true"):dashboard.save(),dashboard.dragAndDrop(),hideModal("popup")}};function savePreference(t,e,a){if("undefined"!=typeof url_prefix)var o=url_prefix+"/settings/";else o="/settings/";var i={};i[t]=e,$.ajax({url:o,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(i),success:function(){"function"==typeof a&&a()}})}function getUnreadMessages(){var t=$("#messages");t.length&&$.ajax({url:url_prefix+"/inbox/",type:"GET",contentType:"application/json",success:function(e){var a=t.parent().parent();e.unread?(t.removeClass("fa-envelope-open-o").addClass("fa-envelope-o"),t.next().text(e.unread),a.attr("data-bs-title",interpolate(gettext("%s unread messages"),[e.unread]))):(t.removeClass("fa-envelope-o").addClass("fa-envelope-open-o"),t.next().text(""),a.attr("data-bs-title",gettext("No unread messages")));var o=bootstrap.Tooltip.getInstance(a);o&&o.dispose(),bootstrap.Tooltip.getOrCreateInstance(a)}})}function getCookie(t){for(var e=document.cookie.split(";"),a=t+"=",o=e.length;o>=0;o--)if(0==jQuery.trim(e[o]).indexOf(a))return jQuery.trim(e[o]).substr(a.length);return null}function setCookie(t,e,a){var o="";if(a){var i=new Date;i.setTime(i.getTime()+24*a*60*60*1e3),o="; expires="+i.toUTCString()}document.cookie=t+"="+(e||"")+o+"; path=/"}function sameOrigin(t){var e="//"+document.location.host,a=document.location.protocol+e;return t==a||t.slice(0,a.length+1)==a+"/"||t==e||t.slice(0,e.length+1)==e+"/"||!/^(\/\/|http:|https:).*/.test(t)}function about_show(){$.ajax({url:"/about/",type:"GET",contentType:"application/json",success:function(t){hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid"),content='<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">About frePPLe</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="row mb-3"><div class="col-6 fw-bold">Version</div><div class="col-6">'+t.version+" "+t.edition+'</div></div><div class="row mb-3"><div class="col-6 fw-bold">Storage</div><div class="col-6'+(t.storage_exceeded?" text-danger":"")+'">'+t.storage_used+" used",t.storage_allocation&&(content+=" of "+t.storage_allocation+" allocated"),content+='</div ></div > <div class="row"><div class="col-6 fw-bold">Active item locations</div><div class="col-6"><table class="table table-sm table-borderless">';for(const[e,a]of Object.entries(t.itemlocations))content+="<tr><td>"+e+"</td><td>"+a+"</td></tr>";for(var e of(content+='</table></div></div> <div class="row mb-3"><div class="col-6 fw-bold">Installed apps</div><div class="col-6">',t.apps))content+=e+"<br>";content+="</div></div></div></div></div>",$("#popup").html(content),showModal("popup")},error:ajaxerror})}function containsObject(t,e){var a;for(a=0;a<e.length;a++)if(e[a]===t)return!0;return!1}function showModal(t,e=!0,a=null){var o,i=document.getElementById(t);e&&((o=bootstrap.Modal.getInstance(i))&&o.dispose());(o=a?bootstrap.Modal.getOrCreateInstance(i,a):bootstrap.Modal.getOrCreateInstance(i)).show()}function hideModal(t){var e=document.getElementById(t),a=bootstrap.Modal.getInstance(e);a&&a.hide()}function import_show(t,e,a,o,i,r){var s={abort:function(){}};hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid");var n='<div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title"><span id="modal_title">'+gettext("Import CSV or Excel file")+'</span>&nbsp;<span id="animatedcog" class="fa fa-cog fa-spin fa-2x fa-fw" style="visibility: hidden;"></span></h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><form id="uploadform"><p id="extra_text">'+gettext("Load an Excel file or a CSV-formatted text file.")+"<br>"+gettext("The first row should contain the field names.")+'<br><br><input class="form-check-input" type="checkbox" autocomplete="off" name="erase" value="yes" id="eraseBeforeImport"/><label for="eraseBeforeImport">&nbsp;&nbsp;'+gettext("First delete all existing records AND ALL RELATED TABLES")+"</label><br></p>";isDragnDropUploadCapable()?n+='<div class="box" style="outline: 2px dashed black; outline-offset: -1em"><div class=text-center box__input" style="text-align: center; padding: 20px;"><input class="box__file d-none" type="file" id="csv_file" name="csv_file" data-multiple-caption="{count} '+gettext("files selected")+'" multiple/><label class="d-block p-3" id="uploadlabel" for="csv_file"><a class="btn btn-primary">'+gettext("Select files to upload")+"</a>&nbsp;"+gettext("or drop them here")+'<i class="fa fa-sign-in fa-2x fa-rotate-90"></i></label></div><div class="d-none box__uploading" style="display: none;">Uploading&hellip;</div><div class="d-none box__success" style="display: none;">Done!</div><div class="box__error" style="display: none;">Error!<span></span>.</div></div>':n+=gettext("Data file")+':<input type="file" id="csv_file" name="csv_file"/>',n+='<br></form><div style="margin: 5px 0"><div id="uploadResponse" style="height: 50vh; resize: vertical; display: none; background-color: inherit; border: none; overflow: auto;"></div></div></div><div class="modal-footer justify-content-between"><input type="submit" id="cancelbutton" role="button" class="btn btn-gray pull-left" data-bs-dismiss="modal" value="'+gettext("Close")+'"><input type="submit" id="copytoclipboard" role="button" class="btn btn-gray pull-left" value="'+gettext("Copy to clipboard")+'" style="display: none;"><input type="submit" id="importbutton" role="button" class="btn btn-primary pull-right" value="'+gettext("Import")+'"><input type="submit" id="cancelimportbutton" role="button" class="btn btn-primary pull-left" value="'+gettext("Cancel Import")+'" style="display: none;"></div></div></div>',$("#popup").html(n),showModal("popup"),""!==t&&$("#modal_title").text(t),void 0!==r&&$("#importbutton").val(r),null===e?$("#extra_text").remove():""!==e&&$("#extra_text").text(e);var l=!1,d=!1;isDragnDropUploadCapable()&&$(".box").on("drag dragstart dragend dragover dragenter dragleave drop",function(t){t.preventDefault(),t.stopPropagation()}).on("dragover dragenter",function(){$(".box").removeClass("bg-warning").addClass("bg-warning")}).on("dragleave dragend drop",function(){$(".box").removeClass("bg-warning")}).on("drop",function(t){l=a?t.originalEvent.dataTransfer.files:[t.originalEvent.dataTransfer.files[0]],$("#uploadlabel").text(l.length>1?($("#csv_file").attr("data-multiple-caption")||"").replace("{count}",l.length):l[0].name)}),$("#csv_file").on("change",function(t){d=a?t.target.files:[t.target.files[0]],$("#uploadlabel").text(d.length>1?($("#csv_file").attr("data-multiple-caption")||"").replace("{count}",d.length):d[0].name)}),null!==i&&void 0!==i&&(l=a?i:[i[0]],$("#uploadlabel").text(l.length>1?($("#csv_file").attr("data-multiple-caption")||"").replace("{count}",l.length):l[0].name)),$("#importbutton").on("click",function(){if(""!==$("#csv_file").val()||l){var t="";$("#uploadResponse").css("display","block"),$("#uploadResponse").html(gettext("Importing...")),$("#uploadResponse").on("scroll",function(){parseInt($("#uploadResponse").attr("data-scrolled"))!==$("#uploadResponse").scrollTop()&&($("#uploadResponse").attr("data-scrolled",!0),$("#uploadResponse").off("scroll"))}),$("#importbutton").hide(),$("#animatedcog").css("visibility","visible"),$("#uploadform").css("display","none"),$("#copytoclipboard").on("click",function(){$("#uploadResponse").find("tr.hidden").remove(),navigator.clipboard.writeText($("#uploadResponse").prop("innerText"))}),$("#cancelimportbutton").show().on("click",function(){$("#uploadResponse").append("<div><strong>"+gettext("Canceled")+"</strong></div>"),s.abort(),$("#animatedcog").css("visibility","hidden"),$("#uploadResponse").append(theclone.contents()),$("#uploadResponse").scrollTop($("#uploadResponse")[0].scrollHeight),$("#cancelimportbutton").hide(),$("#copytoclipboard").show()}),t=new FormData($("#uploadform")[0]),l&&$.each(l,function(e,a){t.append(a.name,a)}),d&&(t.delete("csv_file"),$.each(d,function(e,a){t.append(a.name,a)})),s=$.ajax(Object.assign({type:"post",url:"undefined"!=typeof url?url:"",cache:!1,data:t,success:function(t){var e=$("#uploadResponse");e.html(t),"true"!==e.attr("data-scrolled")&&e.scrollTop(e[0].scrollHeight-e.height()),$("#cancelbutton").html(gettext("Close")),$("#importbutton").hide(),$("#animatedcog").css("visibility","hidden"),$("#cancelimportbutton").hide(),document.queryCommandSupported("copy")&&$("#copytoclipboard").show(),$("#grid").trigger("reloadGrid")},xhrFields:{onprogress:function(t){var e=$("#uploadResponse");e.html(t.currentTarget.response);var a=e.find(".recordcount").last(),o=e.find("[data-cnt]").last().attr("data-cnt");a.text(interpolate(gettext("%s records processed"),[o])),"true"!==e.attr("data-scrolled")&&(e.attr("data-scrolled",e[0].scrollHeight-e.height()),e.scrollTop(e[0].scrollHeight-e.height()))}},error:function(t,e,a){401!=t.status?($("#cancelimportbutton").hide(),$("#copytoclipboard").show(),$("#animatedcog").css("visibility","hidden"),$("#uploadResponse").scrollTop($("#uploadResponse")[0].scrollHeight)):location.reload()},processData:!1,contentType:!1},o))}})}function getURLparameters(){if(0==window.location.search.length)return{};var t={};return jQuery.each(window.location.search.match(/^\??(.*)$/)[1].split("&"),function(e,a){(a=a.split("="))[1]=unescape(a[1]).replace(/\+/g," "),t[a[0]]=t[a[0]]?t[a[0]]instanceof Array?(t[a[0]].push(a[1]),t[a[0]]):[t[a[0]],a[1]]:a[1]}),t}function selectDatabase(t){var e=t.getAttribute("data-database");database!=e&&("default"==database?"/"==window.location.pathname?window.location.href="/"+e+"/":window.location.href=window.location.href.replace(window.location.pathname,"/"+e+window.location.pathname):window.location.href="default"==e?window.location.href.replace("/"+database+"/","/"):window.location.href.replace("/"+database+"/","/"+e+"/"))}$(function(){$(document).ajaxSend(function(t,e,a){!/^(GET|HEAD|OPTIONS|TRACE)$/.test(a.type)&&sameOrigin(a.url)&&e.setRequestHeader("X-CSRFToken",getCookie("csrftoken"))}),$.ajaxSetup({cache:!1}),getUnreadMessages();var t=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:url_prefix+"/search/?term=%QUERY",wildcard:"%QUERY"}});$(".search-input").typeahead({minLength:2},{limit:1e3,highlight:!0,name:"search",display:"value",source:t,templates:{suggestion:function(t){if(null===t.value)return'<span><p style="margin-top: 5px; margin-bottom: 1px;">'+$.jgrid.htmlEncode(t.label)+'</p><li  role="separator" class="divider"></li></span>';var e=url_prefix+t.url;return t.removeTrailingSlash?e+=encodeURIComponent(t.value):e+=admin_escape(t.value)+"/?noautofilter",'<li><a href="'+e+'" >'+$.jgrid.htmlEncode(t.display)+'</a><div class="tt-external"><a target="_blank" href="'+e+'"><i class="fa fa-external-link" aria-hidden="true"></i></a></div></li>'}}})}),$.fn.bindFirst=function(t,e){this.on(t,e),this.each(function(){var e=$._data(this,"events")[t.split(".")[0]],a=e.pop();e.splice(0,0,a)})};var graph={header:function(t,e){var a=$("#grid_graph");a.html("");var o=e.range(),i=e.rangeBand(),r=d3.select(a.get(0)).append("svg");r.attr("height","15px"),r.attr("width",Math.max(a.width(),0));var s=0;for(var n in timebuckets){var l=t+o[n]+i/2;if(s<=l)s=l+r.append("text").attr("class",timebuckets[n].history?"svgheaderhistory":"svgheadertext").attr("x",l).attr("y","12").attr("data-bucket",n).text(timebuckets[n].name).on("mouseenter",function(t){var e=parseInt($(this).attr("data-bucket")),a="&nbsp;"+timebuckets[e].startdate+" - "+timebuckets[e].enddate+"&nbsp;";graph.showTooltip(a.replaceAll(" 00:00:00",""))}).on("mouseleave",graph.hideTooltip).on("mousemove",graph.moveTooltip).node().getComputedTextLength()+12}},showTooltip:function(t){var e=d3.select("#tooltip");e.empty()&&(e=d3.select("body").append("div").attr("id","tooltip").attr("role","tooltip").attr("class","card p-2").style("position","absolute")),e.html(""+t).style("display","block"),graph.moveTooltip()},hideTooltip:function(){d3.select("#tooltip").style("display","none"),d3.event.stopPropagation()},moveTooltip:function(){var t=d3.event.pageX+5,e=d3.event.pageY-28,a=$(window).width()-$("#tooltip").width()-20,o=$(window).height()-$("#tooltip").height()-20;t>a&&(t=a,e=d3.event.pageY+5),e>o&&(e=d3.event.pageY-$("#tooltip").height()-25),d3.select("#tooltip").style({left:t+"px",top:e+"px"}),d3.event.stopPropagation()},miniAxis:function(t){var e=this.scale().range(),a=this.scale().domain();t.append("path").attr("class","domain").attr("d","M-10 0 H0 V"+(e[0]-2)+" H-10"),t.append("text").attr("x",-2).attr("y",13).attr("text-anchor","end").text(grid.formatNumber(Math.round(a[1]))),t.append("text").attr("x",-2).attr("y",e[0]-5).attr("text-anchor","end").text(Math.round(a[0],0))}},gantt={rowsize:25,header:function(t="#jqgh_grid_operationplans"){var e=viewend.getTime()-viewstart.getTime(),a=864e5/e*$(t).width(),o=(horizonend.getTime()-horizonstart.getTime())/e*$(t).width(),i=['<svg width="'+o+'px" height="34px">','<line class="time" x1="0" y1="17" x2="'+o+'" y2="17"/>'],r=0;if(a<5)for(var s=new Date(horizonstart.getFullYear(),horizonstart.getMonth(),1);s<horizonend;){var n=(s.getTime()-viewstart.getTime())/864e5*a,l=new Date(s.getFullYear(),s.getMonth()+1,1),d=(l.getTime()-viewstart.getTime())/864e5*a;if(i.push('<text class="svgheadertext" x="'+Math.floor((n+d)/2)+'" y="31">'+moment(s).format("MMM")+"</text>"),s.getMonth()%3==0){d=(new Date(s.getFullYear(),s.getMonth()+3,1).getTime()-viewstart.getTime())/864e5*a;var c=Math.floor((s.getMonth()+3)/3);i.push('<line class="time" x1="'+Math.floor(n)+'" y1="0" x2="'+Math.floor(n)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor((n+d)/2)+'" y="13">'+s.getFullYear()+" Q"+c+"</text>")}else i.push('<line class="time" x1="'+Math.floor(n)+'" y1="17" x2="'+Math.floor(n)+'" y2="34"/>');s=l}else if(a<10){r-=horizonstart.getDay()*a;for(s=new Date(horizonstart.getTime()-864e5*viewstart.getDay());s<horizonend;)i.push('<line class="time" x1="'+Math.floor(r)+'" y1="17" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor(r+3.5*a)+'" y="31">'+moment(s).format("MM-DD")+"</text>"),r+=7*a,s.setTime(s.getTime()+6048e5);for(s=new Date(horizonstart.getFullYear(),horizonstart.getMonth(),1);s<horizonend;)n=(s.getTime()-viewstart.getTime())/864e5*a,d=((l=new Date(s.getFullYear(),s.getMonth()+1,1)).getTime()-viewstart.getTime())/864e5*a,i.push('<line class="time" x1="'+Math.floor(n)+'" y1="0" x2="'+Math.floor(n)+'" y2="17"/>'),i.push('<text class="svgheadertext" x="'+Math.floor((n+d)/2)+'" y="13">'+moment(s).format("MMM YY")+"</text>"),s=l}else if(a<20){r-=horizonstart.getDay()*a;for(s=new Date(horizonstart.getTime()-864e5*horizonstart.getDay());s<horizonend;)i.push('<line class="time" x1="'+Math.floor(r)+'" y1="17" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+(r+7*a/2)+'" y="31">'+moment(s).format("YY-MM-DD")+"</text>"),r+=7*a,s.setTime(s.getTime()+6048e5);for(s=new Date(horizonstart.getFullYear(),horizonstart.getMonth(),1);s<horizonend;)n=(s.getTime()-viewstart.getTime())/864e5*a,d=((l=new Date(s.getFullYear(),s.getMonth()+1,1)).getTime()-viewstart.getTime())/864e5*a,i.push('<line class="time" x1="'+Math.floor(n)+'" y1="0" x2="'+Math.floor(n)+'" y2="17"/>'),i.push('<text class="svgheadertext" x="'+Math.floor((n+d)/2)+'" y="13">'+moment(s).format("MMM YY")+"</text>"),s=l}else if(a<=40)for(s=new Date(horizonstart.getTime());s<horizonend;)0==s.getDay()?(i.push('<line class="time" x1="'+Math.floor(r)+'" y1="0" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor(r+7*a/2)+'" y="13">'+moment(s).format("YY-MM-DD")+"</text>")):i.push('<line class="time" x1="'+Math.floor(r)+'" y1="17" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor(r+a/2)+'" y="31">'+moment(s).format("DD")+"</text>"),r+=a,s.setDate(s.getDate()+1);else if(a<=75)for(s=new Date(horizonstart.getTime());s<horizonend;)0==s.getDay()?(i.push('<line class="time" x1="'+Math.floor(r)+'" y1="0" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor(r+7*a/2)+'" y="13">'+moment(s).format("YY-MM-DD")+"</text>")):i.push('<line class="time" x1="'+Math.floor(r)+'" y1="17" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor(r+a/2)+'" y="31">'+moment(s).format("DD MM")+"</text>"),r+=a,s.setDate(s.getDate()+1);else if(a<350)for(s=new Date(horizonstart.getTime());s<horizonend;)0==s.getDay()?(i.push('<line class="time" x1="'+Math.floor(r)+'" y1="0" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor(r+3.5*a)+'" y="13">'+moment(s).format("YY-MM-DD")+"</text>")):i.push('<line class="time" x1="'+Math.floor(r)+'" y1="17" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor(r+a/2)+'" y="31">'+moment(s).format("ddd DD MMM")+"</text>"),r+=a,s.setDate(s.getDate()+1);else for(s=new Date(horizonstart.getTime());s<horizonend;)0==s.getHours()?(i.push('<line class="time" x1="'+Math.floor(r)+'" y1="0" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor(r+a/2)+'" y="13">'+moment(s).format("ddd YY-MM-DD")+"</text>")):i.push('<line class="time" x1="'+Math.floor(r)+'" y1="17" x2="'+Math.floor(r)+'" y2="34"/>'),i.push('<text class="svgheadertext" x="'+Math.floor(r+a/48)+'" y="31">'+s.getHours()+"</text>"),r+=a/24,s.setTime(s.getTime()+36e5);i.push("</svg>"),$(t).html(i.join(""))},redraw:function(){var t=(horizonend.getTime()-horizonstart.getTime())/(viewend.getTime()-viewstart.getTime())*$("#jqgh_grid_operationplans").width()/1e4;$(".transformer").each(function(){var e=$(this).attr("title");$(this).attr("transform","scale("+t+",1) translate(0,"+((e-1)*gantt.rowsize+3)+")")}),gantt.header("#jqgh_grid_operationplans")},scroll:function(t){var e=viewend.getTime()-viewstart.getTime();viewstart.setTime(horizonstart.getTime()+$(t.target).scrollLeft()/t.target.scrollWidth*(horizonend.getTime()-horizonstart.getTime())),viewend.setTime(viewstart.getTime()+e);var a=(horizonend.getTime()-horizonstart.getTime())/e*$(t.target).width()/1e4,o=(horizonstart.getTime()-viewstart.getTime())/(horizonend.getTime()-horizonstart.getTime())*1e4;$(".transformer").each(function(){var t=$(this).attr("title");$(this).attr("transform","scale("+a+",1) translate("+o+","+((t-1)*gantt.rowsize+3)+")")})},zoom:function(t,e="#jqgh_grid_operationplans"){var a=(viewend.getTime()-viewstart.getTime())*t;a>=horizonend.getTime()-horizonstart.getTime()?(viewstart.setTime(horizonstart.getTime()),viewend.setTime(horizonend.getTime()),a=viewend.getTime()-viewstart.getTime()):(viewend.setTime(viewstart.getTime()+a),viewend.getTime()>horizonend.getTime()&&(viewend.setTime(horizonend.getTime()),viewstart.setTime(viewend.getTime()-a)));var o=(horizonend.getTime()-horizonstart.getTime())/a*$(e).width()/1e4,i=(horizonstart.getTime()-viewstart.getTime())/(horizonend.getTime()-horizonstart.getTime())*1e4;$(".transformer").each(function(){var t=$(this).attr("title");$(this).attr("transform","scale("+o+",1) translate("+i+","+((t-1)*gantt.rowsize+3)+")")}),gantt.header(e)}};function Gauge(t,e){this.placeholderName=t;var a=this;this.configure=function(t){this.config=t,this.config.size=.9*this.config.size,this.config.raduis=.97*this.config.size/2,this.config.cx=this.config.size/2,this.config.cy=this.config.size/2,this.config.min=void 0!=t.min?t.min:0,this.config.max=void 0!=t.max?t.max:100,this.config.range=this.config.max-this.config.min,this.config.majorTicks=t.majorTicks||5,this.config.minorTicks=t.minorTicks||2,this.config.greenColor=t.greenColor||"#109618",this.config.yellowColor=t.yellowColor||"#FF9900",this.config.redColor=t.redColor||"#DC3912",this.config.transitionDuration=t.transitionDuration||500},this.render=function(){for(var t in this.body=d3.select("#"+this.placeholderName).append("svg:svg").attr("class","gauge").attr("width",this.config.size).attr("height",this.config.size),this.body.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",this.config.raduis).style("fill","#ccc").style("stroke","#000").style("stroke-width","0.5px"),this.body.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",.9*this.config.raduis).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width","2px"),this.config.greenZones)this.drawBand(this.config.greenZones[t].from,this.config.greenZones[t].to,a.config.greenColor);for(var t in this.config.yellowZones)this.drawBand(this.config.yellowZones[t].from,this.config.yellowZones[t].to,a.config.yellowColor);for(var t in this.config.redZones)this.drawBand(this.config.redZones[t].from,this.config.redZones[t].to,a.config.redColor);if(void 0!=this.config.label){var e=Math.round(this.config.size/9);this.body.append("svg:text").attr("x",this.config.cx).attr("y",this.config.cy/2+e/2).attr("dy",e/2).attr("text-anchor","middle").text(this.config.label).style("font-size",e+"px").style("fill","#333").style("stroke-width","0px")}e=Math.round(this.config.size/16);for(var o=this.config.range/(this.config.majorTicks-1),i=this.config.min;i<=this.config.max;i+=o){for(var r=o/this.config.minorTicks,s=i+r;s<Math.min(i+o,this.config.max);s+=r){var n=this.valueToPoint(s,.75),l=this.valueToPoint(s,.85);this.body.append("svg:line").attr("x1",n.x).attr("y1",n.y).attr("x2",l.x).attr("y2",l.y).style("stroke","#666").style("stroke-width","1px")}n=this.valueToPoint(i,.7),l=this.valueToPoint(i,.85);if(this.body.append("svg:line").attr("x1",n.x).attr("y1",n.y).attr("x2",l.x).attr("y2",l.y).style("stroke","#333").style("stroke-width","2px"),i==this.config.min||i==this.config.max){var d=this.valueToPoint(i,.63);this.body.append("svg:text").attr("x",d.x).attr("y",d.y).attr("dy",e/3).attr("text-anchor",i==this.config.min?"start":"end").text(i).style("font-size",e+"px").style("fill","#333").style("stroke-width","0px")}}var c=this.body.append("svg:g").attr("class","pointerContainer"),p=(this.config.min+this.config.max)/2,u=this.buildPointerPath(p),f=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("basis");c.selectAll("path").data([u]).enter().append("svg:path").attr("d",f).style("fill","#dc3912").style("stroke","#c63310").style("fill-opacity",.7),c.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",.12*this.config.raduis).style("fill","#4684EE").style("stroke","#666").style("opacity",1);e=Math.round(this.config.size/10);c.selectAll("text").data([p]).enter().append("svg:text").attr("x",this.config.cx).attr("y",this.config.size-this.config.cy/4-e).attr("dy",e/2).attr("text-anchor","middle").style("font-size",e+"px").style("fill","#000").style("stroke-width","0px"),this.redraw(this.config.value,0)},this.buildPointerPath=function(t){var e=this.config.range/13,o=d(t,.85),i=d(t-e,.12),r=d(t+e,.12),s=t-this.config.range*(1/.75)/2,n=d(s,.28),l=d(s-e,.12);return[o,i,d(s+e,.12),n,l,r,o];function d(t,e){var o=a.valueToPoint(t,e);return o.x-=a.config.cx,o.y-=a.config.cy,o}},this.drawBand=function(t,e,o){0>=e-t||this.body.append("svg:path").style("fill",o).attr("d",d3.svg.arc().startAngle(this.valueToRadians(t)).endAngle(this.valueToRadians(e)).innerRadius(.65*this.config.raduis).outerRadius(.85*this.config.raduis)).attr("transform",function(){return"translate("+a.config.cx+", "+a.config.cy+") rotate(270)"})},this.redraw=function(t,e){var o=this.body.select(".pointerContainer");o.selectAll("text").text(Math.round(t)),o.selectAll("path").transition().duration(void 0!=e?e:this.config.transitionDuration).attrTween("transform",function(){var e=t;t>a.config.max?e=a.config.max+.02*a.config.range:t<a.config.min&&(e=a.config.min-.02*a.config.range);var o=a.valueToDegrees(e)-90,i=a._currentRotation||o;return a._currentRotation=o,function(t){var e=i+(o-i)*t;return"translate("+a.config.cx+", "+a.config.cy+") rotate("+e+")"}})},this.valueToDegrees=function(t){return t/this.config.range*270-(this.config.min/this.config.range*270+45)},this.valueToRadians=function(t){return this.valueToDegrees(t)*Math.PI/180},this.valueToPoint=function(t,e){return{x:this.config.cx-this.config.raduis*e*Math.cos(this.valueToRadians(t)),y:this.config.cy-this.config.raduis*e*Math.sin(this.valueToRadians(t))}},this.configure(e)}function showModalImage(t,e){var a=$("#popup");a.html('<div class="modal-dialog modal-xl" style="margin-top: 20px; width:90%; margin-left: auto; margin-right: auto"><div class="modal-content"><div class="modal-header" style="border-top-left-radius: inherit; border-top-right-radius: inherit"><button type="button" class="btn-close" data-bs-dismiss="modal"></button><h5 class="modal-title"></h5></div><div class="modal-body"><img src="" style="width:100%"></div></div></div>'),a.find("h4").text(e),a.find("img").attr("src",$(t.target).attr("src")),showModal("popup"),t.preventDefault()}$.fn.drags=function(t){if(""===(t=$.extend({handle:"",cursor:"move"},t)).handle)var e=this;else e=this.find(t.handle);return e.css("cursor",t.cursor).on("mousedown",function(e){if(""===t.handle)var a=$(this).addClass("draggable");else a=$(this).addClass("active-handle").parent().addClass("draggable");var o=a.css("z-index"),i=a.outerHeight(),r=a.outerWidth(),s=a.offset().top+i-e.pageY,n=a.offset().left+r-e.pageX;a.css("z-index",1e3).parents().on("mousemove",function(t){$(".draggable").offset({top:t.pageY+s-i,left:t.pageX+n-r}).on("mouseup",function(){$(this).removeClass("draggable").css("z-index",o)})}),e.preventDefault()}).on("mouseup",function(){""===t.handle?$(this).removeClass("draggable"):$(this).removeClass("active-handle").parent().removeClass("draggable")})};var follow={setMethod:function(t){var e=$(t);e.closest(".dropdown").find(".followerspan").text(e.text())},get:function(t,e){var a=$(e);t.preventDefault(),$.ajax({url:url_prefix+"/follow/",data:{object_pk:a.attr("data-pk"),model:a.attr("data-model")},type:"GET",contentType:"application/json; charset=utf-8",success:function(t){hideModal("timebuckets"),$.jgrid.hideModal("#searchmodfbox_grid");var e=$('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title"></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><table id="follower_key" style="width:100%"><tr><th>'+gettext("Follow")+'&nbsp;&nbsp;<span class="dropdown"><button class="form-control w-auto d-inline dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><span class="followerspan"></span>&nbsp;<span class="caret"></button><ul class="dropdown-menu"><li><a class="dropdown-item" href="#" onclick="follow.setMethod(this)">online</a></li><li><a class="dropdown-item" href="#" onclick="follow.setMethod(this)">email</a></li></ul></span></th></tr><tr><td id="follower_models" style="vertical-align:top"></td></tr></table></div><div class="modal-footer justify-content-between"><input type="submit" role="button" class="btn btn-primary" data-bs-dismiss="modal" value="'+gettext("Close")+'"><input type="submit" role="button" class="btn btn-primary" onclick="follow.post(event, this)" value="'+gettext("Update")+'"></div></div></div>');if(e.find(".modal-title").text(interpolate(gettext("Manage notifications of %s"),[t.label+" "+t.object_pk],!1)),e.find(".followerspan").text(t.type),e.find("#follower_key").attr("data-model",t.model).attr("data-object_pk",t.object_pk),t.parents)for(var a of t.parents){(o=$("<div style='margin-top:10px; margin-bottom:10px'>"+gettext("Following")+" "+a.model+" <a class='text-decoration-underline' target='_blank'></a></div>")).find("a").attr("href",a.url).text(a.object_pk),o.find("a").append($("<i style='text-indent:0.5em' class='fa fa-external-link'></i>")),e.find("td").first().append(o)}else if(t.models)for(var a of t.models){(o=$("<div class='form-check'><label><input class='form-check-input' type='checkbox'/><span class='text-capitalize'></span></label></div>")).find("span").text(a.label),o.find("input").attr("data-model",a.model),a.checked&&o.find("input").attr("checked","true"),e.find("td").first().append(o)}if(t.users){var o=$("<th></th>");for(var i of(o.text(gettext("Add followers")),e.find("th").after(o),o=$("<td id='follower_users' style='vertical-align:top'></td>"),t.users)){var r=$("<div class='form-check'><label><input  class='form-check-input' type='checkbox'/><span class='followername'></span></label>&nbsp;&nbsp;<span class=\"dropdown\">"+'<button class="form-control w-auto d-inline dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><span class="followerspan"></span>&nbsp;<span class="caret"></button><ul class="dropdown-menu"><li><a class="dropdown-item" href="#" onclick="follow.setMethod(this)">online</a></li><li><a class="dropdown-item" href="#" onclick="follow.setMethod(this)">email</a></li></ul></span></div>');r.find("input").attr("data-username",i.username),"no"!=i.following&&r.find("input").attr("checked","true"),r.find(".followerspan").text("email"==i.following?"email":"online"),"indirect"==i.following&&(r.find("input").attr("disabled","disabled"),r.find(".dropdown").addClass("disabled")),r.find("span.followername").text(i.username),o.append(r)}e.find("td").after(o)}$("#popup").html(e),showModal("popup")},error:ajaxerror})},post:function(){var t=$("#popup"),e=t.find("#follower_key"),a={object_pk:e.attr("data-object_pk"),model:e.attr("data-model"),type:t.find("#follower_key .followerspan").text(),users:{},models:[]};t.find("#follower_users input:checked").each(function(){"disabled"!=$(this).attr("disabled")&&(a.users[$(this).attr("data-username")]=$(this).closest(".checkbox").find(".followerspan").text())}),t.find("#follower_models input:checked").each(function(){a.models.push($(this).attr("data-model"))}),$.ajax({url:url_prefix+"/follow/",data:JSON.stringify([a]),type:"POST",contentType:"application/json",success:function(){hideModal("popup")},error:ajaxerror})}};
//# sourceMappingURL=frepple.min.js.map